<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Shark Bounty | Earn SHB</title>
  <link rel="icon" href="https://github.com/s42144/Shark-Bounty/blob/2866754c94b76ddcc4908dbb08ada52cc61368e2/Gemini_Generated_Image_ouqprcouqprcouqp.png" />
  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9970324" data-sdk="show_9970324"></script>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #1d1e60 0%, #27b3ff 100%);
      --bg-gradient2: linear-gradient(120deg, #311c7b 0%, #ff61a6 100%);
      --card-bg: rgba(255,255,255,0.08);
      --panel-bg: rgba(0,0,0,0.38);
      --accent: #27cdfc;
      --accent2: #ff61a6;
      --btn-gradient: linear-gradient(95deg, #27cdfc 0%, #ff61a6 100%);
      --btn-shadow: 0 6px 24px #ff61a655;
      --btn-radius: 18px;
      --btn-txt: #fff;
      --card-radius: 22px;
      --shadow: 0 4px 32px #0003;
      --input-bg: rgba(255,255,255,0.18);
      --input-border: #27cdfc;
      --card-line: #ffffff14;
      --nav-bg: rgba(38,39,62,0.98);
      --nav-active: #ff61a6;
      --tapplus-glow: 0 0 18px #27cdfc99, 0 2px 14px #ff61a6aa;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100vw;
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg-gradient);
      color: #fff;
      overflow-x: hidden;
      touch-action: manipulation;
      min-height: 100vh;
    }
    #intro-video {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: 9999;
      background: #000;
      display: block;
    }
    #app {
      display: none;
      width: 100vw;
      min-height: 100vh;
      padding-bottom: 70px;
      box-sizing: border-box;
      background: var(--bg-gradient2);
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-size: cover;
    }
    /* ---------- SIMPLIFIED HOME SECTION ---------- */
    .home-main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: none;
      width: 100vw;
      min-height: 100vh;
      height: 100vh;
      overflow: hidden;
      position: relative;
      touch-action: none;
      overscroll-behavior: none;
    }
    body, html, #main-content {
      overscroll-behavior: none !important;
    }
    #main-content { width: 100vw; }
    .home-balance {
      font-size: 4.6rem;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 0;
      margin-top: 0;
      color: #fff;
      text-align: center;
      user-select: none;
      background: none;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
      border: none;
      transition: color .2s, background .3s;
      text-shadow: none;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 30px;
      z-index: 10;
      width: 100vw;
    }
    .coin-btn-3d-wrap {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 1600px;
      height: 1600px;
      margin: 150px auto 0 auto;
      z-index: 2;
      touch-action: manipulation;
    }
    @media (max-width:1700px) {
      .coin-btn-3d-wrap { width: 900px; height: 900px; margin-top: 80px; }
    }
    @media (max-width:1200px) {
      .coin-btn-3d-wrap { width: 600px; height: 600px; margin-top: 60px; }
    }
    @media (max-width:900px) {
      .coin-btn-3d-wrap { width: 350px; height: 350px; margin-top: 40px; }
    }
    @media (max-width:600px) {
      .coin-btn-3d-wrap { width: 180px; height: 180px; margin-top: 12vw; }
    }
    .coin-3d-anim {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 1600px;
      height: 1600px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1;
    }
    @media (max-width:1700px) {
      .coin-3d-anim { width: 900px; height: 900px; }
    }
    @media (max-width:1200px) {
      .coin-3d-anim { width: 600px; height: 600px; }
    }
    @media (max-width:900px) {
      .coin-3d-anim { width: 350px; height: 350px; }
    }
    @media (max-width:600px) {
      .coin-3d-anim { width: 180px; height: 180px; }
    }
    .coin-btn {
      width: 1400px;
      height: 1400px;
      border-radius: 50%;
      background: #fff;
      border: none;
      box-shadow: 0 8px 32px rgba(0,0,0,0.14), 0 12px 44px #27cdfc44;
      margin: 0 0 0 0;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      position: relative;
      outline: none;
      transition: box-shadow .13s, transform .12s;
      background: #fff;
      z-index: 2;
      touch-action: manipulation;
    }
    @media (max-width:1700px) {
      .coin-btn { width: 800px; height: 800px; }
    }
    @media (max-width:1200px) {
      .coin-btn { width: 430px; height: 430px; }
    }
    @media (max-width:900px) {
      .coin-btn { width: 200px; height: 200px; }
    }
    @media (max-width:600px) {
      .coin-btn { width: 92px; height: 92px; }
    }
    .coin-btn:hover, .coin-btn:active {
      box-shadow: 0 8px 32px #27cdfc77, 0 2px 24px #ff61a6bb, 0 12px 44px #27cdfc44;
      transform: scale(1.03);
    }
    .coin-btn img {
      width: 1200px;
      height: 1200px;
      border-radius: 50%;
      object-fit: cover;
      background: #111114;
      box-shadow: none;
      filter: none;
      z-index: 2;
      position: relative;
      pointer-events: none;
      user-select: none;
    }
    @media (max-width:1700px) {
      .coin-btn img { width: 700px; height: 700px; }
    }
    @media (max-width:1200px) {
      .coin-btn img { width: 350px; height: 350px; }
    }
    @media (max-width:900px) {
      .coin-btn img { width: 140px; height: 140px; }
    }
    @media (max-width:600px) {
      .coin-btn img { width: 56px; height: 56px; }
    }
    .tap-plus {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -90%);
      color: var(--accent2);
      font-size: 2.6rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.12s, transform 0.22s;
      pointer-events: none;
      z-index: 3;
      text-shadow: var(--tapplus-glow);
      font-family: inherit;
      letter-spacing: 1.5px;
    }
    .home-info-row {
      width: 100vw;
      max-width: 580px;
      margin: 30px auto 0;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0;
      background: none;
      box-shadow: none;
      z-index: 12;
      position: relative;
    }
    .home-info-col {
      flex: 1;
      text-align: center;
      color: #fff;
      font-size: 1.18rem;
      font-weight: 400;
      line-height: 1.38;
      letter-spacing: 0.01em;
      background: none;
      border: none;
      box-shadow: none;
      padding: 0;
    }
    .home-info-col .label {
      font-size: 1.06rem;
      font-weight: 400;
      color: #ccc;
      margin-bottom: 7px;
      display: block;
      letter-spacing: 0.05em;
    }
    .home-info-col .value {
      font-size: 1.32rem;
      font-weight: 700;
      margin-bottom: 2px;
      display: block;
      color: #fff;
      text-shadow: none;
    }
    .home-info-col .desc {
      font-size: 1.05rem;
      color: #c0c0c0;
      margin-top: 2px;
      display: block;
    }
    .nav-bar {
      position: fixed;
      bottom: 0; left: 0; width: 100vw;
      background: var(--nav-bg);
      display: flex;
      gap: 0;
      justify-content: space-around;
      align-items: center;
      padding: 8px 0 4px 0;
      z-index: 20;
      box-shadow: 0 -2px 22px 0px #311c7b44;
      border-top: 2px solid var(--accent2);
      backdrop-filter: blur(10px);
    }
    .nav-btn {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      min-width: 55px;
      font-size: 0.95rem;
      color: #fff;
      cursor: pointer;
      border-radius: 19px 19px 0 0;
      opacity: 0.88;
      transition: background 0.14s, opacity 0.14s, color 0.16s;
      box-shadow: none;
      font-weight: 500;
    }
    .nav-btn img {
      width: 32px; height: 32px;
      margin-bottom: 2px;
      border-radius: 8px;
      border: 2px solid transparent;
      box-shadow: 0 2px 12px #27cdfc22;
      transition: border .13s;
    }
    .nav-btn.active {
      background: var(--btn-gradient);
      opacity: 1;
      color: #fff;
      box-shadow: 0 -2px 24px #27cdfc55;
    }
    .nav-btn.active img {
      border: 2px solid var(--nav-active);
    }
    .booster-main, .earn-main, .profile-main, .ranking-main {
      margin: 38px auto 0;
      max-width: 380px;
      width: 97vw;
      padding: 18px 0 0 0;
      background: var(--card-bg);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow);
      border: 1.5px solid var(--card-line);
    }
    .booster-section {
      margin: 25px auto 22px auto;
      padding: 24px 14px 16px 14px;
      border-radius: 22px;
      background: var(--panel-bg);
      box-shadow: 0 2px 16px #1d1e6055;
      border-left: 5px solid var(--accent);
      border-right: 5px solid var(--accent2);
      background-blend-mode: overlay;
      background-size: cover;
      background-position: center;
    }
    .booster-section .title {
      font-size: 1.22rem;
      font-weight: bold;
      margin-bottom: 9px;
      color: var(--accent);
      letter-spacing: 0.05em;
    }
    .booster-section .price {
      font-size: 1.08rem;
      font-weight: 500;
      color: var(--accent2);
      margin-bottom: 13px;
    }
    .booster-section .desc {
      font-size: .98rem;
      color: #d6eaff;
      margin-top: 7px;
      opacity: 0.97;
    }
    .buy-btn {
      width: 100%;
      padding: 12px 0;
      margin: 10px 0;
      background: var(--btn-gradient);
      color: var(--btn-txt);
      border: none;
      border-radius: var(--btn-radius);
      font-size: 1.08rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--btn-shadow);
      transition: background 0.13s, box-shadow .12s, filter .11s;
      letter-spacing: 0.07em;
      outline: none;
    }
    .buy-btn:disabled {
      background: #444;
      color: #bbb;
      box-shadow: none;
      cursor: not-allowed;
    }
    .buy-btn:not(:disabled):hover {
      filter: brightness(1.09) contrast(1.08);
      box-shadow: 0 6px 30px #ff61a6bb;
    }
    .earn-main { padding-bottom: 24px; }
    .earn-stats-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--panel-bg);
      border-radius: 13px;
      padding: 10px 15px;
      margin-bottom: 18px;
      border: 1.5px solid var(--accent2);
      box-shadow: 0 1px 10px #27cdfc22;
    }
    .earn-stat-cell { text-align: center; flex: 1; }
    .earn-stat-label {
      font-size: .93rem;
      color: #bce9fa;
      font-weight: 500;
      margin-bottom: 2px;
      display: block;
    }
    .earn-stat-value {
      font-size: 1.13rem;
      color: var(--accent2);
      font-weight: bold;
      display: block;
    }
    .ad-section {
      margin-bottom: 18px;
      padding: 13px 10px 18px 10px;
      background: var(--panel-bg);
      border-radius: 16px;
      box-shadow: 0 1px 10px #27cdfc22;
      text-align: center;
      border: 1.5px solid var(--accent2);
    }
    .show-ad-btn {
      width: 95%;
      padding: 12px 0;
      margin: 11px 0 0 0;
      background: var(--btn-gradient);
      color: var(--btn-txt);
      border: none;
      border-radius: var(--btn-radius);
      font-size: 1.03rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--btn-shadow);
      transition: background 0.13s, filter .13s;
      outline: none;
    }
    .show-ad-btn:disabled {
      background: #444;
      color: #bbb;
      box-shadow: none;
      cursor: not-allowed;
    }
    .show-ad-btn:not(:disabled):hover {
      filter: brightness(1.08) contrast(1.08);
    }
    .ad-stats {
      display: flex;
      justify-content: space-between;
      margin: 8px 0 0 0;
      gap: 4px;
    }
    .ad-stats-box {
      background: var(--card-bg);
      border-radius: 9px;
      padding: 4px 9px;
      font-size: 0.92rem;
      font-weight: 500;
      color: var(--accent);
      border: 1px solid var(--accent2);
    }
    .tasks-list, #earnTasksList { margin-top: 18px; }
    .task-card {
      display: flex;
      align-items: center;
      background: var(--panel-bg);
      border-radius: 15px;
      margin-bottom: 16px;
      box-shadow: 0 2px 10px #1d1e6055;
      padding: 10px;
      border: 1.5px solid var(--accent);
      gap: 12px;
    }
    .task-photo {
      width: 54px; height: 54px;
      border-radius: 15px;
      object-fit: cover;
      margin-right: 10px;
      border: 2px solid var(--accent2);
    }
    .task-info { flex: 1; }
    .task-title {
      font-size: 1.04rem;
      color: var(--accent);
      font-weight: bold;
      margin-bottom: 3px;
    }
    .task-amount {
      font-size: 0.96rem;
      color: var(--accent2);
      margin-bottom: 3px;
      font-weight: 500;
    }
    .task-btn {
      min-width: 80px;
      padding: 6px 12px;
      border-radius: 14px;
      background: var(--btn-gradient);
      color: var(--btn-txt);
      border: none;
      font-weight: 700;
      font-size: 1.01rem;
      cursor: pointer;
      transition: filter .13s, background .13s;
      box-shadow: 0 2px 10px #ff61a655;
    }
    .task-btn.completed {
      background: #34343b;
      color: #bbb;
      cursor: not-allowed;
      box-shadow: none;
    }
    .task-btn:not(.completed):hover { filter: brightness(1.13); }
    .profile-main {
      text-align: center;
      padding-bottom: 25px;
      position: relative;
    }
    .avatar-box {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      margin-bottom: 18px;
    }
    .avatar-img {
      width: 85px; height: 105px;
      border-radius: 12px;
      border: 4px solid var(--accent2);
      object-fit: cover;
      margin-right: 0;
      box-shadow: 0 2px 14px #ff61a6bb;
      background: #fff;
    }
    .userid-box {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      justify-content: center;
      margin-left: 10px;
    }
    .userid {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 4px 15px;
      color: var(--accent);
      font-weight: 700;
      font-size: 1.01rem;
    }
    .copy-btn, .ref-copy-btn {
      background: var(--btn-gradient);
      border: none;
      border-radius: 50%;
      padding: 3px 3px;
      cursor: pointer;
      margin-left: 7px;
      transition: filter .13s;
      width: 28px; height: 28px;
      display: flex; align-items: center; justify-content: center;
      box-shadow: var(--btn-shadow);
    }
    .copy-btn:hover, .ref-copy-btn:hover { filter: brightness(1.18); }
    .copy-btn img, .ref-copy-btn img { width: 18px; height: 18px; border-radius: 50%; }
    .ton-form {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 19px;
      margin-top: 4px;
    }
    .ton-input {
      padding: 10px 15px;
      border-radius: 13px;
      border: 2px solid var(--input-border);
      background: var(--input-bg);
      color: #fff;
      font-size: 1.01rem;
      outline: none;
      width: 65%;
      margin-right: 8px;
    }
    .ton-save-btn {
      background: var(--btn-gradient);
      color: #fff;
      border: none;
      border-radius: 14px;
      padding: 8px 20px;
      font-weight: 600;
      font-size: 1.02rem;
      cursor: pointer;
      box-shadow: var(--btn-shadow);
      transition: filter .13s;
    }
    .ton-save-btn:hover { filter: brightness(1.11); }
    .referral-section {
      margin-top: 24px;
      background: var(--panel-bg);
      border-radius: 14px;
      padding: 14px 11px 13px 11px;
      box-shadow: 0 2px 10px #27cdfc22;
      border: 1.5px solid var(--accent2);
    }
    .ref-link-box {
      display: flex;
      align-items: center;
      gap: 7px;
      margin-bottom: 12px;
      justify-content: center;
    }
    .ref-link {
      font-size: 0.98rem;
      color: var(--accent);
      font-weight: 600;
      background: var(--card-bg);
      padding: 3px 12px;
      border-radius: 10px;
      letter-spacing: 0.05em;
      user-select: all;
      cursor: pointer;
    }
    .ref-counts {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      margin-top: 3px;
      font-size: 0.98rem;
      color: #fff;
    }
    .ref-counts b {
      color: var(--accent2);
    }
    .redeem-profile-box {
      margin: 24px auto 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      max-width: 310px;
    }
    .redeem-input {
      padding: 10px 15px;
      border-radius: 13px;
      border: 2px solid var(--input-border);
      background: var(--input-bg);
      color: #fff;
      font-size: 1.08rem;
      outline: none;
      width: 110px;
      letter-spacing: 4px;
      font-weight: 700;
      text-align: center;
    }
    .redeem-btn {
      background: var(--btn-gradient);
      color: #fff;
      border: none;
      border-radius: 14px;
      padding: 10px 25px;
      font-weight: 700;
      font-size: 1.08rem;
      cursor: pointer;
      box-shadow: var(--btn-shadow);
      transition: filter .13s;
    }
    .redeem-btn:hover { filter: brightness(1.09); }
    .ranking-main {
      padding-bottom: 30px;
    }
    .ranking-summary {
      font-weight:bold;
      margin-bottom:10px;
      font-size:1.12rem;
      color:var(--accent2)
    }
    .ranking-position {
      font-size: 1.09rem;
      margin-bottom: 10px;
      color: var(--accent2);
      text-align: center;
      font-weight: bold;
    }
    .ranking-list { margin-top: 10px; }
    .ranking-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--panel-bg);
      border-radius: 13px;
      padding: 10px 16px;
      margin-bottom: 7px;
      font-size: 1.01rem;
      color: #fff;
      border: 1.3px solid var(--accent);
      box-shadow: 0 2px 10px #27cdfc22;
    }
    .ranking-pos {
      font-weight: 700;
      color: var(--accent2);
      font-size: 1.12rem;
      width: 34px;
      text-align: center;
    }
    .ranking-userid {
      flex: 1;
      text-align: left;
      margin-left: 12px;
      color: var(--accent);
      font-weight: 500;
    }
    .ranking-shb {
      font-weight: 700;
      color: var(--accent);
      font-size: 1.09rem;
    }
    .notif {
      position: fixed; top: 5%; left: 50%; transform: translateX(-50%);
      background: var(--btn-gradient);
      color: #fff;
      border-radius: 19px;
      padding: 14px 35px;
      font-size: 1.09rem;
      font-weight: bold;
      z-index: 99999; 
      text-align: center; 
      box-shadow: 0 2px 36px #ff61a688;
      animation: notifIn 0.24s;
      border: 2px solid var(--accent2);
      letter-spacing: 0.03em;
    }
    @keyframes notifIn {0%{opacity:0;transform:scale(0.7) translateX(-50%);}100%{opacity:1;transform:scale(1) translateX(-50%);}}
    @media(max-width:600px){
      .home-main{margin-top:0;}
      .coin-btn-3d-wrap{width:180px;height:180px;margin-top:12vw;}
      .coin-3d-anim{width:180px;height:180px;}
      .coin-btn{width:92px;height:92px;}
      .coin-btn img{width:56px;height:56px;}
      .home-balance{font-size:2.2rem;}
      .home-info-row{max-width:98vw;}
      .booster-main,.earn-main,.profile-main,.ranking-main{margin-top:21px;}
      .booster-main, .earn-main, .profile-main, .ranking-main {padding: 8px 0;}
      .booster-section{padding:14px 7px;}
      .notif{font-size:0.98rem;padding:10px 15px;}
      .redeem-btn{padding:8px 18px;}
      .avatar-img{width:60px;height:75px;}
      .ref-link{font-size:0.87rem;}
      .ranking-list{margin-top: 6px;}
    }
  </style>
</head>
<body>
  <!-- Intro Video -->
  <video id="intro-video" autoplay playsinline muted>
    <source src="https://github.com/s42144/Shark-Bounty/blob/2866754c94b76ddcc4908dbb08ada52cc61368e2/Gemini_Generated_Image_ouqprcouqprcouqp.png" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
  <!-- Main App -->
  <div id="app">
    <div id="main-content"></div>
    <div class="nav-bar" id="navBar">
      <button class="nav-btn active" data-tab="home">
        <img src="https://github.com/s42144/Shark-Bounty/blob/2866754c94b76ddcc4908dbb08ada52cc61368e2/Gemini_Generated_Image_ouqprcouqprcouqp.png" alt="Home" />
      </button>
      <button class="nav-btn" data-tab="booster">
        <img src="https://github.com/s42144/Shark-Bounty/blob/8d39f59ff89f208085ebfd7dd5215d83540d07a0/Gemini_Generated_Image_959w6i959w6i959w.png" alt="Booster" />
      </button>
      <button class="nav-btn" data-tab="earn">
        <img src="https://github.com/s42144/Shark-Bounty/blob/22d006ded3f1218d451dcc86cecd29d05f4143bb/Gemini_Generated_Image_4q0ubt4q0ubt4q0u.png" alt="Earn" />
      </button>
      <button class="nav-btn" data-tab="tasks" style="display:none"></button>
      <button class="nav-btn" data-tab="profile">
        <img src="https://github.com/s42144/Shark-Bounty/blob/e0eba3a1590959ed038170471a209f3c97eac482/Gemini_Generated_Image_r0cs8ur0cs8ur0cs.png" alt="Profile" />
      </button>
      <button class="nav-btn" data-tab="ranking">
        <img src="https://github.com/s42144/Shark-Bounty/blob/03d0b20caaa1791d4ffcd68272802aa9baa9ee55/Gemini_Generated_Image_aehvceaehvceaehv.png" alt="Ranking" />
      </button>
    </div>
  </div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAHofuS76xf2oGPaJqEtopmcxdoJzjkDL4",
      authDomain: "zmex-investments.firebaseapp.com",
      databaseURL: "https://zmex-investments-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "zmex-investments",
      storageBucket: "zmex-investments.appspot.com",
      messagingSenderId: "971623941364",
      appId: "1:971623941364:web:6c65604fc45c3f64e74aa1",
      measurementId: "G-KQ1LYP77JF"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userId = null;
    let userData = null;
    let energyTimer = null;
    let adStats = { today: 0, daily: 0, monthly: 0, lifetime: 0 };
    let booster = { energy: 1200, maxEnergy: 1200, multiTap: 1, incomeBooster: false };
    let coinsEarned = 0;
    let rankingData = [];
    let tasksList = [];
    let referrals = { count: 0, eject: 0 };
    let redeemCodes = {};
    let adLoading = false;

    function notify(msg, duration=2000){ 
      const box = document.createElement('div');
      box.className = 'notif'; box.textContent = msg;
      document.body.appendChild(box);
      setTimeout(()=>{ box.remove(); }, duration);
    }

    // Generate/Load User ID
    function getOrSetUserId(){
      let id = localStorage.getItem('shb_userid');
      if(!id){
        id = (Math.floor(10000+Math.random()*89999)).toString();
        localStorage.setItem('shb_userid', id);
      }
      userId = id;
    }
    getOrSetUserId();

    // Fetch/Create User Data
    function loadUserData(){
      db.ref('users/'+userId).once('value').then(snap=>{
        if(snap.exists()) userData = snap.val();
        else {
          userData = {
            balance: 0, energy: 1200, maxEnergy: 1200, multiTap: 1, incomeBooster: false,
            ton: "", avatar: "https://github.com/s42144/Shark-Bounty/blob/ce666a11f202e2d875d39799725c81a4efec0b37/Gemini_Generated_Image_53edn53edn53edn5.png",
            referrals: 0, eject: 0, completedTasks: {}, adStats:{today:0,daily:0,monthly:0,lifetime:0}
          };
          db.ref('users/'+userId).set(userData);
        }
        booster.energy = userData.energy;
        booster.maxEnergy = userData.maxEnergy;
        booster.multiTap = userData.multiTap;
        booster.incomeBooster = userData.incomeBooster;
        coinsEarned = userData.balance;
        adStats = userData.adStats||{today:0,daily:0,monthly:0,lifetime:0};
        referrals.count = userData.referrals||0;
        referrals.eject = userData.eject||0;
        showTab('home');
        setupIncomeBooster();
      });
    }

    function updateUserData(newData){
      Object.assign(userData, newData);
      db.ref('users/'+userId).update(newData);
      if(newData.balance!==undefined) coinsEarned = newData.balance;
      if(newData.energy!==undefined) booster.energy = newData.energy;
      if(newData.maxEnergy!==undefined) booster.maxEnergy = newData.maxEnergy;
      if(newData.multiTap!==undefined) booster.multiTap = newData.multiTap;
      if(newData.incomeBooster!==undefined) booster.incomeBooster = newData.incomeBooster;
      if(newData.adStats!==undefined) adStats = newData.adStats;
      if(newData.referrals!==undefined) referrals.count = newData.referrals;
      if(newData.eject!==undefined) referrals.eject = newData.eject;
    }

    function showTab(tab){
      document.querySelectorAll('.nav-btn').forEach(btn=>{
        btn.classList.toggle('active',btn.dataset.tab===tab);
      });
      if(tab==='home') renderHome();
      if(tab==='booster') renderBooster();
      if(tab==='earn') renderEarn();
      if(tab==='profile') renderProfile();
      if(tab==='ranking') renderRanking();
    }

    // Home Section: 2× coin/logo, balance above, tap on coin or animation, disable scrolling
    function renderHome(){
      let profit = userData.incomeBooster ? Math.floor(userData.balance/3600) : 0;
      let coinPerTap = 1;
      let maxTouch = booster.multiTap;
      let html = `<div class="home-main" id="homeMain">
        <div class="home-balance" id="homeBalance">${coinsEarned}</div>
        <div class="coin-btn-3d-wrap" id="coinWrap">
          <canvas class="coin-3d-anim" id="coin3d" width="1600" height="1600"></canvas>
          <button class="coin-btn" id="coinBtn" tabindex="0">
            <img src="https://github.com/s42144/Shark-Bounty/blob/aeb441877b43b7401af99870ead870597d62f885/17510103.gif?raw=true" alt="Coin" draggable="false"/>
            <span class="tap-plus" id="tapPlus">+1</span>
          </button>
        </div>
        <div class="home-info-row">
          <div class="home-info-col">
            <span class="label">ENERGY</span>
            <span class="value" id="energyLabel">${Math.floor(booster.energy)} / ${booster.maxEnergy}</span>
            <span class="desc">+0.5/sec, -1/tap</span>
          </div>
          <div class="home-info-col">
            <span class="label">FINGER</span>
            <span class="value" id="fingerLabel">${maxTouch}</span>
            <span class="desc">multi-finger tap</span>
          </div>
          <div class="home-info-col">
            <span class="label">PROFIT</span>
            <span class="value" id="profitLabel">${profit}</span>
            <span class="desc">every hour</span>
          </div>
        </div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      setupCoin3D();
      setupEnergyRecovery();
      setupCoinTapping();
      // Prevent scrolling in home section
      document.body.style.overflow = "hidden";
      document.documentElement.style.overflow = "hidden";
      document.getElementById('main-content').style.overflow = "hidden";
      document.getElementById('main-content').style.height = "100vh";
    }
    // 2× 3D Animated Ring using Canvas, tap on ring also triggers tap
    function setupCoin3D() {
      const canvas = document.getElementById('coin3d');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = canvas.width, h = canvas.height, r = Math.min(w,h)/2-10;
      let angle = 0;
      let anim;
      function drawRing() {
        ctx.clearRect(0,0,w,h);
        let cx = w/2, cy = h/2;
        ctx.save();
        ctx.beginPath();
        ctx.arc(cx, cy, r-14, 0, 2*Math.PI);
        ctx.shadowColor = "#27cdfc88";
        ctx.shadowBlur = 70;
        ctx.globalAlpha = 0.19;
        ctx.fillStyle = "#27cdfc";
        ctx.fill();
        ctx.restore();
        ctx.save();
        ctx.translate(cx, cy);
        for(let i=0; i<360; i+=7){
          let rad = ((i+angle)%360)*Math.PI/180;
          let x = Math.cos(rad)*(r-5), y = Math.sin(rad)*(r-5);
          ctx.beginPath();
          ctx.arc(x, y, 18, 0, 2*Math.PI);
          let grad = ctx.createRadialGradient(x, y, 5, x, y, 18);
          grad.addColorStop(0, "#fff");
          grad.addColorStop(0.45, "#27cdfc");
          grad.addColorStop(1, "#ff61a6");
          ctx.globalAlpha = 0.46 + Math.cos(rad+angle*0.4)*0.24;
          ctx.fillStyle = grad;
          ctx.fill();
        }
        ctx.restore();
        ctx.globalAlpha = 1;
      }
      function animateRing() {
        angle += 2.7;
        drawRing();
        anim = requestAnimationFrame(animateRing);
      }
      animateRing();
      canvas._stopAnim = () => cancelAnimationFrame(anim);

      // Tapping on the ring triggers tap too
      canvas.onclick = function(e) {
        // Only trigger if on home
        if (document.getElementById('coinBtn')) {
          document.getElementById('coinBtn').click();
        }
      };
      canvas.ontouchstart = function(e){
        if(document.getElementById('coinBtn'))
          document.getElementById('coinBtn').click();
      };
    }
    function destroyCoin3D() {
      const canvas = document.getElementById('coin3d');
      if(canvas && canvas._stopAnim) canvas._stopAnim();
    }
    // Tapping directly on coin or animation triggers tap
    function setupCoinTapping(){
      // Coin click
      const btn = document.getElementById('coinBtn');
      let tapPlus = document.getElementById('tapPlus');
      btn.ontouchstart = function(e){
        performTap(1);
      };
      btn.onclick = function(){ performTap(1); };
      // Make coin image itself trigger tap for pointer events
      btn.querySelector('img').onclick = function(e){
        performTap(1);
      };
      btn.querySelector('img').ontouchstart = function(e){
        performTap(1);
      };
      function performTap(count){
        if(booster.energy<count){
          notify('Not enough energy!');
          return;
        }
        booster.energy -= count;
        coinsEarned += 1;
        updateUserData({balance:coinsEarned,energy:booster.energy});
        tapPlus.textContent = '+1';
        tapPlus.style.opacity = 1;
        tapPlus.style.transform = 'translate(-50%, -170%) scale(1.2)';
        setTimeout(()=>{tapPlus.style.opacity=0;tapPlus.style.transform='translate(-50%, -90%) scale(1)';},500);
        updateEnergyBar();
        document.getElementById('homeBalance').textContent = coinsEarned;
      }
    }
    function updateEnergyBar(){
      let label = document.getElementById('energyLabel');
      if(label){
        label.textContent = Math.floor(booster.energy)+' / '+booster.maxEnergy;
      }
    }
    function updateInfoRow() {
      let fingerEl = document.getElementById('fingerLabel');
      let profitEl = document.getElementById('profitLabel');
      if(fingerEl) fingerEl.textContent = booster.multiTap;
      if(profitEl) profitEl.textContent = userData.incomeBooster ? Math.floor(userData.balance/3600) : 0;
    }
    function setupEnergyRecovery(){
      if(energyTimer) clearInterval(energyTimer);
      energyTimer = setInterval(()=>{
        if(booster.energy<booster.maxEnergy){
          booster.energy += 0.5;
          booster.energy = Math.min(booster.energy, booster.maxEnergy);
          updateUserData({energy:Math.round(booster.energy)});
          updateEnergyBar();
        }
      },1000);
    }
    let incomeBoosterTimer = null;
    function setupIncomeBooster(){
      if(incomeBoosterTimer) clearInterval(incomeBoosterTimer);
      if(userData.incomeBooster){
        incomeBoosterTimer = setInterval(()=>{
          coinsEarned++;
          updateUserData({balance:coinsEarned});
          updateInfoRow();
        },10000);
      }
    }
    function renderBooster(){
      let html = `<div class="booster-main">
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/243506472e8b36c6b629f74aa163195e8f10b591/Gemini_Generated_Image_6kb4426kb4426kb4.png')">
          <div class="title">Increase Energy</div>
          <div class="price">Price: 10,000 SHB</div>
          <button class="buy-btn" id="buyEnergy" ${coinsEarned<10000?'disabled':''}>Buy</button>
          <div class="desc">Increase max energy by 500 each purchase.</div>
        </div>
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/021ff5cfe0d46f2283bcf175038f613a8772221b/Gemini_Generated_Image_4bcr194bcr194bcr.png')">
          <div class="title">Allow Multi-finger Tapping</div>
          <div class="price">Price: 15,000 SHB</div>
          <button class="buy-btn" id="buyMultiTap" ${coinsEarned<15000||(userData.multiTap>=4)?'disabled':''}>Buy</button>
          <div class="desc">Buy once: 2 fingers. Buy again: 4 fingers total.</div>
        </div>
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/243506472e8b36c6b629f74aa163195e8f10b591/Gemini_Generated_Image_6kb4426kb4426kb4.png')">
          <div class="title">Income Booster</div>
          <div class="price">Price: 100,000 SHB</div>
          <button class="buy-btn" id="buyIncomeBooster" ${coinsEarned<100000||userData.incomeBooster?'disabled':''}>Buy</button>
          <div class="desc">Earn 1 SHB every 10s, even offline. Buy only once.</div>
        </div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      document.getElementById('buyEnergy').onclick = function(){
        if(coinsEarned<10000){notify('Not enough SHB!');return;}
        coinsEarned -= 10000;
        booster.maxEnergy += 500;
        booster.energy = booster.maxEnergy;
        updateUserData({balance:coinsEarned,maxEnergy:booster.maxEnergy,energy:booster.maxEnergy});
        notify('Max energy increased!');
        renderBooster();
      };
      document.getElementById('buyMultiTap').onclick = function(){
        if(coinsEarned<15000){notify('Not enough SHB!');return;}
        if(userData.multiTap>=4){notify('Max multi-tap reached!');return;}
        coinsEarned -= 15000;
        let nextTap = userData.multiTap==1?2:4;
        booster.multiTap = nextTap;
        updateUserData({balance:coinsEarned,multiTap:nextTap});
        notify('Multi-finger tapping upgraded!');
        renderBooster();
        if(document.querySelector('.home-main')) updateInfoRow();
      };
      document.getElementById('buyIncomeBooster').onclick = function(){
        if(coinsEarned<100000){notify('Not enough SHB!');return;}
        if(userData.incomeBooster){notify('Already purchased!');return;}
        coinsEarned -= 100000;
        booster.incomeBooster = true;
        updateUserData({balance:coinsEarned,incomeBooster:true});
        notify('Passive income enabled!');
        setupIncomeBooster();
        renderBooster();
        if(document.querySelector('.home-main')) updateInfoRow();
      };
    }
    function renderEarn(){
      let html = `<div class="earn-main">
        <div class="earn-stats-bar">
          <div class="earn-stat-cell">
            <span class="earn-stat-label">Today</span>
            <span class="earn-stat-value">${adStats.today}</span>
          </div>
          <div class="earn-stat-cell">
            <span class="earn-stat-label">Daily</span>
            <span class="earn-stat-value">${adStats.daily}</span>
          </div>
          <div class="earn-stat-cell">
            <span class="earn-stat-label">Monthly</span>
            <span class="earn-stat-value">${adStats.monthly}</span>
          </div>
          <div class="earn-stat-cell">
            <span class="earn-stat-label">Lifetime</span>
            <span class="earn-stat-value">${adStats.lifetime}</span>
          </div>
        </div>
        <div class="ad-section">
          <div class="title" style="font-weight:bold;font-size:1.08rem;">SHOW ADS</div>
          <button class="show-ad-btn" id="showAdBtn">${adLoading?'Loading...':'Show Ad (+500 SHB)'}</button>
        </div>
        <div class="tasks-list" id="earnTasksList"></div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      setupShowAd();
      loadTasksEarn();
    }
    function setupShowAd(){
      document.getElementById('showAdBtn').onclick = function(){
        if(adLoading)return;
        adLoading=true;
        this.textContent='Loading...';
        if(typeof show_9970324 === 'function'){
          show_9970324().then(()=>{
            adLoading=false;
            this.textContent='Show Ad (+500 SHB)';
            coinsEarned+=500;
            adStats.today++; adStats.daily++; adStats.monthly++; adStats.lifetime++;
            updateUserData({balance:coinsEarned,adStats});
            notify('+500 SHB for ad!');
            renderEarn();
          }).catch(err=>{
            adLoading=false; this.textContent='Show Ad (+500 SHB)';
            notify('Ad failed!');
          });
        }else{
          adLoading=false; this.textContent='Show Ad (+500 SHB)';
          notify('Ad not ready!');
        }
      };
    }
    function loadTasksEarn(){
      db.ref('tasks').once('value').then(snap=>{
        let tasks = snap.val()||{};
        let html = '';
        Object.keys(tasks).forEach(tid=>{
          let t = tasks[tid];
          let completed = userData.completedTasks&&userData.completedTasks[tid];
          html += `<div class="task-card">
            <img src="${t.photo}" class="task-photo" />
            <div class="task-info">
              <div class="task-title">${t.name}</div>
              <div class="task-amount">Earn: ${t.amount} SHB</div>
            </div>
            <button class="task-btn ${completed?'completed':''}" data-tid="${tid}">${completed?'Completed':'Start'}</button>
          </div>`;
        });
        document.getElementById('earnTasksList').innerHTML = html;
        document.querySelectorAll('.task-btn').forEach(btn=>{
          btn.onclick = function(){
            let tid = this.dataset.tid;
            if(userData.completedTasks&&userData.completedTasks[tid]){
              window.open(tasks[tid].link, '_blank');
              return;
            }
            coinsEarned += parseInt(tasks[tid].amount);
            if(!userData.completedTasks) userData.completedTasks={};
            userData.completedTasks[tid]=true;
            updateUserData({balance:coinsEarned,completedTasks:userData.completedTasks});
            notify(`+${tasks[tid].amount} SHB for completing task!`);
            renderEarn();
            window.open(tasks[tid].link, '_blank');
          };
        });
      });
    }
    function renderProfile(){
      // Try to fetch referral data live for userId
      db.ref('users')
        .orderByChild('referrals')
        .equalTo(userId)
        .once('value')
        .then(refSnap => {
          let myRefCount = userData.referrals || 0;
          let myEjectCount = userData.eject || 0;
          let html = `<div class="profile-main">
            <div class="avatar-box">
              <img src="${userData.avatar}" class="avatar-img" alt="Avatar"/>
              <div>
                <div class="userid-box">
                  <span class="userid">ID: ${userId}</span>
                  <button class="copy-btn" id="copyUidBtn"><img src="https://github.com/s42144/Shark-Bounty/blob/825ed4052493a404a9581203eb5d104be0165506/Gemini_Generated_Image_xqtqegxqtqegxqtq.png" /></button>
                </div>
              </div>
            </div>
            <form class="ton-form" onsubmit="return false;">
              <input class="ton-input" id="tonInput" placeholder="Enter TON Wallet Address" value="${userData.ton||''}" />
              <button class="ton-save-btn" id="tonSaveBtn">Save</button>
            </form>
            <div class="referral-section">
              <div style="font-weight:bold;margin-bottom:6px;">Referrals</div>
              <div class="ref-link-box">
                <span class="ref-link" id="refLink">https://t.me/SharkBountybot?start=r${userId}</span>
                <button class="ref-copy-btn" id="refCopyBtn"><img src="https://github.com/s42144/Shark-Bounty/blob/825ed4052493a404a9581203eb5d104be0165506/Gemini_Generated_Image_xqtqegxqtqegxqtq.png" /></button>
              </div>
              <div class="ref-counts">
                <span>Total Referrals: <b id="refCount">${myRefCount}</b></span>
                <span>Eject Referrals: <b id="ejectCount">${myEjectCount}</b></span>
              </div>
            </div>
            <div class="redeem-profile-box">
              <input class="redeem-input" id="redeemInput" maxlength="4" placeholder="Enter 4-digit code" />
              <button class="redeem-btn" id="redeemBtn">Redeem</button>
            </div>
          </div>`;
          document.getElementById('main-content').innerHTML = html;
          document.getElementById('copyUidBtn').onclick = function(){
            navigator.clipboard.writeText(userId).then(()=>notify('User ID copied!'));
          };
          document.getElementById('refCopyBtn').onclick = function(){
            navigator.clipboard.writeText(document.getElementById('refLink').textContent).then(()=>notify('Referral link copied!'));
          };
          document.getElementById('refLink').onclick = function(){
            navigator.clipboard.writeText(this.textContent).then(()=>notify('Referral link copied!'));
          };
          document.getElementById('tonSaveBtn').onclick = function(){
            let val = document.getElementById('tonInput').value.trim();
            if(val.length<10){notify('Invalid TON wallet!');return;}
            updateUserData({ton:val});
            notify('TON wallet saved!');
          };
          document.getElementById('redeemBtn').onclick = function(){
            let code = document.getElementById('redeemInput').value.trim();
            if(code.length!==4){notify('Enter valid 4-digit code!');return;}
            db.ref('redeemCodes/'+code).once('value').then(snap=>{
              if(snap.exists()){
                coinsEarned+=500;
                updateUserData({balance:coinsEarned});
                db.ref('redeemCodes/'+code).remove();
                notify('+500 SHB redeemed!');
                renderProfile();
              }else{
                notify('Invalid or already used code!');
              }
            });
          };
        });
    }

    // LIVE RANKING SECTION — top 200, show my position, no total users
    let rankingListener = null;
    function renderRanking(){
      document.getElementById('main-content').innerHTML = `<div class="ranking-main">
        <div class="ranking-summary">Top 200 Users by SHB Balance</div>
        <div class="ranking-position" id="myRankingPos"></div>
        <div class="ranking-list" id="rankingList"></div>
      </div>`;
      if(rankingListener) rankingListener.off();
      const usersRef = db.ref('users');
      function updateRankingList(snap) {
        let arr = [];
        snap.forEach(child=>{
          arr.push({
            id: child.key,
            shb: child.val().balance || 0
          });
        });
        arr.sort((a,b)=>b.shb-a.shb);
        // Find my position
        let myPos = arr.findIndex(u => u.id === userId) + 1;
        let top200 = arr.slice(0,200);
        let html = '';
        top200.forEach((row,i)=>{
          html += `<div class="ranking-row">
            <span class="ranking-pos">${i+1}</span>
            <span class="ranking-userid">ID: ${row.id}</span>
            <span class="ranking-shb">${row.shb} SHB</span>
          </div>`;
        });
        document.getElementById('rankingList').innerHTML = html;
        document.getElementById('myRankingPos').innerHTML = `Your Position: <b>${myPos > 0 ? myPos : 'Unranked'}</b>`;
      }
      usersRef.on('value', updateRankingList);
      rankingListener = usersRef;
    }

    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.onclick = function(){
        if (!btn.classList.contains('active') && document.querySelector('.home-main')) destroyCoin3D();
        // Restore scrolling if not home
        if(btn.dataset.tab !== "home"){
          document.body.style.overflow = "";
          document.documentElement.style.overflow = "";
          document.getElementById('main-content').style.overflow = "";
          document.getElementById('main-content').style.height = "";
        }
        showTab(btn.dataset.tab);
      }
    });

    document.getElementById('intro-video').addEventListener('ended',()=>{
      document.getElementById('intro-video').style.display='none';
      document.getElementById('app').style.display='block';
      loadUserData();
    });
    document.getElementById('intro-video').addEventListener('error',()=>{
      document.getElementById('intro-video').style.display='none';
      document.getElementById('app').style.display='block';
      loadUserData();
    });
    window.onload = function(){
      if(document.getElementById('intro-video').ended||document.getElementById('intro-video').style.display==='none'){
        document.getElementById('intro-video').style.display='none';
        document.getElementById('app').style.display='block';
        loadUserData();
      }
    }
  </script>
</body>
</html>
