<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Shark Bounty | Earn SHB</title>
  <link rel="icon" href="https://github.com/s42144/Shark-Bounty/blob/dedf1f3379f4a52180a500e818e467dcd99f56c9/1057118.png?raw=true" />
  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9970324" data-sdk="show_9970324"></script>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100vw;
      font-family: 'Inter', Arial, sans-serif;
      background: #151a2d;
      color: #222;
      overflow-x: hidden;
      touch-action: manipulation;
    }
    #intro-video {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: 9999;
      background: #000;
      display: block;
    }
    #app {
      display: none;
      width: 100vw;
      min-height: 100vh;
      padding-bottom: 64px;
      box-sizing: border-box;
    }
    .balance-bar {
      position: fixed;
      top: 18px; left: 18px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1rem;
      padding: 8px 20px;
      z-index: 10;
      min-width: 110px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    .nav-bar {
      position: fixed;
      bottom: 0; left: 0; width: 100vw;
      background: linear-gradient(to top, #151a2d 95%, transparent);
      display: flex;
      gap: 0;
      justify-content: space-around;
      align-items: center;
      padding: 7px 0;
      z-index: 20;
      box-shadow: 0 -2px 16px 0px rgba(0,0,0,0.18);
    }
    .nav-btn {
      flex: 1;
      background: none;
      border: none;
      outline: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      min-width: 55px;
      font-size: 0.85rem;
      color: #fff;
      cursor: pointer;
      transition: background 0.12s;
      border-radius: 14px 14px 0 0;
    }
    .nav-btn img {
      width: 32px; height: 32px;
      margin-bottom: 2px;
      border-radius: 8px;
    }
    .nav-btn.active { background: #212b48; }

    /* Home */
    .home-main {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 50px;
    }
    .energy-bar {
      width: 220px;
      height: 22px;
      background: #eee;
      border-radius: 16px;
      margin: 22px auto 10px;
      position: relative;
      box-shadow: 0 2px 12px rgba(22,34,34,0.13);
    }
    .energy-fill {
      height: 100%;
      background: linear-gradient(90deg,#ffbc00,#ff6a00);
      border-radius: 16px;
      transition: width 0.3s;
    }
    .energy-label {
      position: absolute;
      left: 10px; top: 2px;
      font-size: 13px; color: #222;
      font-weight: bold;
      z-index: 2;
    }
    .coin-btn {
      width: 140px; height: 140px;
      border-radius: 999px;
      border: none;
      background: none;
      box-shadow: 0 5px 24px rgba(255,140,0,0.16);
      margin: 28px auto 10px;
      position: relative;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      touch-action: manipulation;
    }
    .coin-btn img { width: 100%; height: 100%; border-radius: 50%; }
    .tap-plus {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -120%);
      color: #15fa89;
      font-size: 1.6rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.12s, transform 0.22s;
      pointer-events: none;
      z-index: 3;
      text-shadow: 0 2px 12px #222;
    }

    /* Booster */
    .booster-main {
      margin: 38px auto 0;
      max-width: 340px;
      width: 96vw;
      display: flex; flex-direction: column; gap: 24px;
    }
    .booster-section {
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(22,34,34,0.18);
      padding: 15px;
      color: #fff;
      position: relative;
      background-size: cover; background-position: center;
      min-height: 115px;
      display: flex; flex-direction: column; justify-content: center;
    }
    .booster-section .title {
      font-size: 1.08rem; font-weight: bold;
      margin-bottom: 6px;
    }
    .booster-section .price {
      font-size: 0.98rem; margin-bottom: 10px; font-weight: 600;
    }
    .booster-section .buy-btn {
      padding: 7px 22px;
      border-radius: 7px;
      background: #15fa89;
      color: #222;
      font-weight: bold;
      border: none;
      font-size: 0.98rem;
      cursor: pointer;
      margin-bottom: 4px;
      transition: background 0.12s;
    }
    .booster-section .buy-btn:disabled { background:#bbb; color: #555; cursor:not-allowed; }
    .booster-section .desc { font-size: 0.92rem; margin-top: 3px; }

    /* Earn */
    .earn-main { margin: 38px auto 0; max-width: 340px; width: 96vw; }
    .ad-section { background:#fff; border-radius:14px; padding:14px 10px 20px; box-shadow:0 2px 8px rgba(22,34,34,.13); margin-bottom:12px; }
    .ad-stats { display:flex; gap:16px; font-size:0.95rem; margin:8px 0 0; }
    .ad-stats-box { flex:1; background:#eee; border-radius:8px; padding:8px 5px; text-align:center; font-weight:600; }
    .show-ad-btn { background:linear-gradient(90deg,#ff8c00,#ff4500); color:#fff; border-radius:9px; border:none; font-size:1.09rem; font-weight:bold; padding:12px 0; margin:14px auto 0; width:80%; cursor:pointer; box-shadow:0 2px 12px #ff6a00a8; }
    .show-ad-btn:active {background:linear-gradient(90deg,#ff4500,#ff6347);}
    .tasks-list { margin:18px 0; }
    .task-card { background:#f5f6fa; border-radius:13px; padding:13px; box-shadow:0 2px 8px rgba(22,34,34,.07); margin-bottom:10px; display:flex; align-items:center; gap:10px; }
    .task-photo { width:44px; height:44px; border-radius:11px; object-fit:cover; border:2px solid #eee; }
    .task-info { flex:1; }
    .task-title { font-weight:bold; margin-bottom:6px; font-size:0.98rem;}
    .task-btn { background:#15fa89; color:#222; border:none; border-radius:7px; padding:6px 16px; font-weight:600; font-size:0.94rem; cursor:pointer;}
    .task-btn.completed { background:#bbb; color:#666; cursor:not-allowed;}

    /* Profile */
    .profile-main { margin:44px auto 0; max-width:340px; width:96vw; display:flex; flex-direction:column; gap:24px;}
    .avatar-box { display:flex; align-items:center; gap:14px; margin-bottom:9px;}
    .avatar-img { width:54px; height:54px; border-radius:99px; border:2.5px solid #eee;}
    .userid-box { display:flex; align-items:center; gap:7px;}
    .userid { font-weight:600; font-size:1.07rem; color:#222; }
    .copy-btn { background:none; border:none; cursor:pointer; padding:0; }
    .copy-btn img { width:22px; height:22px; }
    .ton-form { margin:12px 0 0; display:flex; gap:7px; }
    .ton-input { flex:1; padding:8px 12px; border-radius:9px; border:1.5px solid #ccc; font-size:1rem; }
    .ton-save-btn { background:#15fa89; color:#222; border:none; border-radius:7px; padding:7px 18px; font-weight:600; font-size:0.95rem; cursor:pointer;}
    .referral-section {margin:18px 0 0;}
    .ref-link-box {display:flex;align-items:center;gap:7px;}
    .ref-link {font-size:0.98rem;font-weight:600;word-break:break-all;}
    .ref-copy-btn {background:none;border:none;cursor:pointer;padding:0;}
    .ref-copy-btn img {width:22px;height:22px;}
    .ref-counts {margin:8px 0;font-size:0.92rem;color:#222;}
    .ref-counts span {margin-right:12px;}
    /* Ranking */
    .ranking-main {margin:38px auto 0;max-width:340px;width:96vw;}
    .ranking-list {margin:18px 0;}
    .ranking-row {display:flex;align-items:center;gap:8px;background:#f5f6fa;border-radius:13px;padding:8px 10px;margin-bottom:7px;}
    .ranking-pos {font-weight:bold;width:26px;text-align:center;}
    .ranking-userid {font-size:0.98rem;font-weight:600;}
    .ranking-shb {font-size:0.98rem;color:#15fa89;font-weight:bold;}
    /* Redeem */
    .redeem-main {margin:44px auto 0;max-width:340px;width:96vw;}
    .redeem-box {background:#fff;border-radius:12px;padding:16px 12px;box-shadow:0 2px 8px rgba(22,34,34,.11);}
    .redeem-input {width:100%;padding:9px 13px;border-radius:8px;border:1.5px solid #ccc;font-size:1.07rem;margin-bottom:8px;}
    .redeem-btn {background:#15fa89;color:#222;border:none;border-radius:7px;padding:11px 0;width:100%;font-weight:600;font-size:1.1rem;cursor:pointer;}
    /* iOS style notification */
    .notif {
      position: fixed; top: 5%; left: 50%; transform: translateX(-50%);
      background: rgba(22,22,22,0.96); color: #fff;
      border-radius: 18px; padding: 13px 32px; font-size: 1.08rem; font-weight: bold;
      z-index: 99999; text-align: center; box-shadow: 0 2px 24px #2228;
      animation: notifIn 0.24s;
    }
    @keyframes notifIn {0%{opacity:0;transform:scale(0.7) translateX(-50%);}100%{opacity:1;transform:scale(1) translateX(-50%);}}
    /* Responsive */
    @media(max-width:600px){
      .home-main,.booster-main,.earn-main,.profile-main,.ranking-main,.redeem-main{margin-top:21px;}
      .coin-btn{width:110px;height:110px;}
      .energy-bar{width:160px;}
    }
  </style>
</head>
<body>
  <!-- Intro Video -->
  <video id="intro-video" autoplay playsinline muted>
    <source src="https://github.com/s42144/Shark-Bounty/raw/8b67f2028cd3d33d6545243ea43a57958c428edf/29f4182c-fb84-4f6e-830f-f560ae571afe.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
  <!-- Main App -->
  <div id="app">
    <div class="balance-bar" id="balanceBar">Balance: 0 SHB</div>
    <div id="main-content"></div>
    <div class="nav-bar" id="navBar">
      <button class="nav-btn active" data-tab="home">
        <img src="https://github.com/s42144/Shark-Bounty/blob/dedf1f3379f4a52180a500e818e467dcd99f56c9/1057118.png?raw=true" alt="Home" />
        Home
      </button>
      <button class="nav-btn" data-tab="booster">
        <img src="https://github.com/s42144/Shark-Bounty/blob/afd79a5abbf33e4b89606ee8f02538a8d385b1d9/images%20(1).png?raw=true" alt="Booster" />
        Booster
      </button>
      <button class="nav-btn" data-tab="earn">
        <img src="https://github.com/s42144/Shark-Bounty/blob/e39a21566184e34a27cd1d48c67c6bd04429acde/images%20(4).jpeg?raw=true" alt="Earn" />
        Earn
      </button>
      <button class="nav-btn" data-tab="tasks">
        <img src="https://github.com/s42144/Shark-Bounty/blob/2ba42299505308ea4ff2a68f5db8341f3ddc0e92/16104409.png?raw=true" alt="Tasks" />
        Tasks
      </button>
      <button class="nav-btn" data-tab="profile">
        <img src="https://github.com/s42144/Shark-Bounty/blob/11c6e035a7f8f6445526ea07f34893fd3ceec419/18827926.png?raw=true" alt="Profile" />
        Profile
      </button>
      <button class="nav-btn" data-tab="ranking">
        <img src="https://github.com/s42144/Shark-Bounty/blob/74b1e06fd560efe8e058569ffa7b4e363aa1c43d/13311710.png?raw=true" alt="Ranking" />
        Ranking
      </button>
      <button class="nav-btn" data-tab="redeem">
        <img src="https://github.com/s42144/Shark-Bounty/blob/87e28aa35db580efad4a8befa50df073a1c80e1f/3179668.png?raw=true" alt="Redeem" />
        Redeem
      </button>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAHofuS76xf2oGPaJqEtopmcxdoJzjkDL4",
      authDomain: "zmex-investments.firebaseapp.com",
      databaseURL: "https://zmex-investments-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "zmex-investments",
      storageBucket: "zmex-investments.appspot.com",
      messagingSenderId: "971623941364",
      appId: "1:971623941364:web:6c65604fc45c3f64e74aa1",
      measurementId: "G-KQ1LYP77JF"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // User data
    let userId = null;
    let userData = null;
    let energyTimer = null;
    let adStats = { today: 0, daily: 0, monthly: 0, lifetime: 0 };
    let booster = { energy: 1200, maxEnergy: 1200, multiTap: 1, incomeBooster: false };
    let coinsEarned = 0;
    let rankingData = [];
    let tasksList = [];
    let referrals = { count: 0, eject: 0 };
    let redeemCodes = {};
    let adLoading = false;

    // Simple iOS Notification
    function notify(msg, duration=2000){ 
      const box = document.createElement('div');
      box.className = 'notif'; box.textContent = msg;
      document.body.appendChild(box);
      setTimeout(()=>{ box.remove(); }, duration);
    }

    // Generate/Load User ID
    function getOrSetUserId(){
      let id = localStorage.getItem('shb_userid');
      if(!id){
        id = (Math.floor(10000+Math.random()*89999)).toString();
        localStorage.setItem('shb_userid', id);
      }
      userId = id;
    }
    getOrSetUserId();

    // Fetch/Create User Data
    function loadUserData(){
      db.ref('users/'+userId).once('value').then(snap=>{
        if(snap.exists()) userData = snap.val();
        else {
          userData = {
            balance: 0, energy: 1200, maxEnergy: 1200, multiTap: 1, incomeBooster: false,
            ton: "", avatar: "https://github.com/s42144/Shark-Bounty/blob/11c6e035a7f8f6445526ea07f34893fd3ceec419/18827926.png?raw=true",
            referrals: 0, eject: 0, completedTasks: {}, adStats:{today:0,daily:0,monthly:0,lifetime:0}
          };
          db.ref('users/'+userId).set(userData);
        }
        booster.energy = userData.energy;
        booster.maxEnergy = userData.maxEnergy;
        booster.multiTap = userData.multiTap;
        booster.incomeBooster = userData.incomeBooster;
        coinsEarned = userData.balance;
        adStats = userData.adStats||{today:0,daily:0,monthly:0,lifetime:0};
        referrals.count = userData.referrals||0;
        referrals.eject = userData.eject||0;
        updateBalanceBar();
        showTab('home');
        setupIncomeBooster();
      });
    }

    function updateUserData(newData){
      Object.assign(userData, newData);
      db.ref('users/'+userId).update(newData);
      if(newData.balance!==undefined) coinsEarned = newData.balance;
      if(newData.energy!==undefined) booster.energy = newData.energy;
      if(newData.maxEnergy!==undefined) booster.maxEnergy = newData.maxEnergy;
      if(newData.multiTap!==undefined) booster.multiTap = newData.multiTap;
      if(newData.incomeBooster!==undefined) booster.incomeBooster = newData.incomeBooster;
      if(newData.adStats!==undefined) adStats = newData.adStats;
      if(newData.referrals!==undefined) referrals.count = newData.referrals;
      if(newData.eject!==undefined) referrals.eject = newData.eject;
      updateBalanceBar();
    }

    // Update Balance Display
    function updateBalanceBar(){
      document.getElementById('balanceBar').textContent = `Balance: ${coinsEarned} SHB`;
    }

    // Show Tab
    function showTab(tab){
      document.querySelectorAll('.nav-btn').forEach(btn=>{
        btn.classList.toggle('active',btn.dataset.tab===tab);
      });
      if(tab==='home') renderHome();
      if(tab==='booster') renderBooster();
      if(tab==='earn') renderEarn();
      if(tab==='tasks') renderTasks();
      if(tab==='profile') renderProfile();
      if(tab==='ranking') renderRanking();
      if(tab==='redeem') renderRedeem();
    }

    // Home Section: Coin, Energy, Tap Animation
    function renderHome(){
      let html = `<div class="home-main">
        <div class="energy-bar">
          <div class="energy-fill" id="energyFill" style="width:${Math.round(booster.energy/booster.maxEnergy*100)}%;"></div>
          <div class="energy-label" id="energyLabel">${booster.energy} / ${booster.maxEnergy} Energy</div>
        </div>
        <button class="coin-btn" id="coinBtn">
          <img src="https://github.com/s42144/Shark-Bounty/blob/aeb441877b43b7401af99870ead870597d62f885/17510103.gif?raw=true" alt="Coin"/>
          <span class="tap-plus" id="tapPlus">+1</span>
        </button>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      setupEnergyRecovery();
      setupCoinTapping();
    }

    function setupCoinTapping(){
      const btn = document.getElementById('coinBtn');
      let tapPlus = document.getElementById('tapPlus');
      // Multi-finger tap
      let tapCount = 0;
      btn.ontouchstart = function(e){
        tapCount = booster.multiTap>1 ? Math.min(e.touches.length, booster.multiTap) : 1;
        performTap(tapCount);
      };
      btn.onclick = function(){ performTap(1); };
      function performTap(count){
        if(booster.energy<1){
          notify('Not enough energy!');
          return;
        }
        booster.energy -= count;
        coinsEarned += count;
        updateUserData({balance:coinsEarned,energy:booster.energy});
        // Animate
        tapPlus.textContent = '+'+count;
        tapPlus.style.opacity = 1;
        tapPlus.style.transform = 'translate(-50%, -170%) scale(1.2)';
        setTimeout(()=>{tapPlus.style.opacity=0;tapPlus.style.transform='translate(-50%, -120%) scale(1)';},500);
        updateEnergyBar();
      }
    }

    function updateEnergyBar(){
      let fill = document.getElementById('energyFill');
      let label = document.getElementById('energyLabel');
      if(fill&&label){
        fill.style.width = Math.round(booster.energy/booster.maxEnergy*100)+'%';
        label.textContent = booster.energy+' / '+booster.maxEnergy+' Energy';
      }
    }

    function setupEnergyRecovery(){
      if(energyTimer) clearInterval(energyTimer);
      energyTimer = setInterval(()=>{
        if(booster.energy<booster.maxEnergy){
          booster.energy++;
          updateUserData({energy:booster.energy});
          updateEnergyBar();
        }
      },2000);
    }

    // Passive Income Booster
    let incomeBoosterTimer = null;
    function setupIncomeBooster(){
      if(incomeBoosterTimer) clearInterval(incomeBoosterTimer);
      if(userData.incomeBooster){
        incomeBoosterTimer = setInterval(()=>{
          coinsEarned++;
          updateUserData({balance:coinsEarned});
        },10000);
      }
    }

    // Booster Section
    function renderBooster(){
      let html = `<div class="booster-main">
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/79fd7356e653ad0460b3d96e51be077d49c2255e/images%20(2).png?raw=true')">
          <div class="title">Increase Energy</div>
          <div class="price">Price: 10,000 SHB</div>
          <button class="buy-btn" id="buyEnergy" ${coinsEarned<10000?'disabled':''}>Buy</button>
          <div class="desc">Increase max energy by 500 each purchase.</div>
        </div>
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/f3ddf6b3fe4ecd6276ce8ff07b54c35ed8cab5ea/images%20(3).png?raw=true')">
          <div class="title">Allow Multi-finger Tapping</div>
          <div class="price">Price: 15,000 SHB</div>
          <button class="buy-btn" id="buyMultiTap" ${coinsEarned<15000||(userData.multiTap>=4)?'disabled':''}>Buy</button>
          <div class="desc">Buy once: 2 fingers. Buy again: 4 fingers total.</div>
        </div>
        <div class="booster-section" style="background-image:url('https://github.com/s42144/Shark-Bounty/blob/67f79ce003358d837c24fccb6df407f1ff52175e/images%20(4).png?raw=true')">
          <div class="title">Income Booster</div>
          <div class="price">Price: 100,000 SHB</div>
          <button class="buy-btn" id="buyIncomeBooster" ${coinsEarned<100000||userData.incomeBooster?'disabled':''}>Buy</button>
          <div class="desc">Earn 1 SHB every 10s, even offline. Buy only once.</div>
        </div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;

      document.getElementById('buyEnergy').onclick = function(){
        if(coinsEarned<10000){notify('Not enough SHB!');return;}
        coinsEarned -= 10000;
        booster.maxEnergy += 500;
        booster.energy = booster.maxEnergy;
        updateUserData({balance:coinsEarned,maxEnergy:booster.maxEnergy,energy:booster.maxEnergy});
        notify('Max energy increased!');
        renderBooster();
      };
      document.getElementById('buyMultiTap').onclick = function(){
        if(coinsEarned<15000){notify('Not enough SHB!');return;}
        if(userData.multiTap>=4){notify('Max multi-tap reached!');return;}
        coinsEarned -= 15000;
        let nextTap = userData.multiTap==1?2:4;
        booster.multiTap = nextTap;
        updateUserData({balance:coinsEarned,multiTap:nextTap});
        notify('Multi-finger tapping upgraded!');
        renderBooster();
      };
      document.getElementById('buyIncomeBooster').onclick = function(){
        if(coinsEarned<100000){notify('Not enough SHB!');return;}
        if(userData.incomeBooster){notify('Already purchased!');return;}
        coinsEarned -= 100000;
        booster.incomeBooster = true;
        updateUserData({balance:coinsEarned,incomeBooster:true});
        notify('Passive income enabled!');
        setupIncomeBooster();
        renderBooster();
      };
    }

    // Earn Section
    function renderEarn(){
      let html = `<div class="earn-main">
        <div class="ad-section">
          <div class="title" style="font-weight:bold;font-size:1.08rem;">SHOW ADS</div>
          <div class="ad-stats">
            <div class="ad-stats-box">Today: ${adStats.today}</div>
            <div class="ad-stats-box">Daily: ${adStats.daily}</div>
            <div class="ad-stats-box">Monthly: ${adStats.monthly}</div>
            <div class="ad-stats-box">Lifetime: ${adStats.lifetime}</div>
          </div>
          <button class="show-ad-btn" id="showAdBtn">${adLoading?'Loading...':'Show Ad (+500 SHB)'}</button>
        </div>
        <div class="tasks-list" id="earnTasksList"></div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      setupShowAd();
      loadTasksEarn();
    }
    function setupShowAd(){
      document.getElementById('showAdBtn').onclick = function(){
        if(adLoading)return;
        adLoading=true;
        this.textContent='Loading...';
        if(typeof show_9970324 === 'function'){
          show_9970324().then(()=>{
            adLoading=false;
            this.textContent='Show Ad (+500 SHB)';
            coinsEarned+=500;
            adStats.today++; adStats.daily++; adStats.monthly++; adStats.lifetime++;
            updateUserData({balance:coinsEarned,adStats});
            notify('+500 SHB for ad!');
            renderEarn();
          }).catch(err=>{
            adLoading=false; this.textContent='Show Ad (+500 SHB)';
            notify('Ad failed!');
          });
        }else{
          adLoading=false; this.textContent='Show Ad (+500 SHB)';
          notify('Ad not ready!');
        }
      };
    }
    function loadTasksEarn(){
      db.ref('tasks').once('value').then(snap=>{
        let tasks = snap.val()||{};
        let html = '';
        Object.keys(tasks).forEach(tid=>{
          let t = tasks[tid];
          let completed = userData.completedTasks&&userData.completedTasks[tid];
          html += `<div class="task-card">
            <img src="${t.photo}" class="task-photo" />
            <div class="task-info">
              <div class="task-title">${t.name}</div>
              <div class="task-amount">Earn: ${t.amount} SHB</div>
            </div>
            <button class="task-btn ${completed?'completed':''}" data-tid="${tid}">${completed?'Completed':'Start'}</button>
          </div>`;
        });
        document.getElementById('earnTasksList').innerHTML = html;
        document.querySelectorAll('.task-btn').forEach(btn=>{
          btn.onclick = function(){
            let tid = this.dataset.tid;
            if(userData.completedTasks&&userData.completedTasks[tid]){
              window.open(tasks[tid].link, '_blank');
              return;
            }
            coinsEarned += parseInt(tasks[tid].amount);
            if(!userData.completedTasks) userData.completedTasks={};
            userData.completedTasks[tid]=true;
            updateUserData({balance:coinsEarned,completedTasks:userData.completedTasks});
            notify(`+${tasks[tid].amount} SHB for completing task!`);
            renderEarn();
            window.open(tasks[tid].link, '_blank');
          };
        });
      });
    }

    // Tasks Section (same as Earn but with all tasks)
    function renderTasks(){
      let html = `<div class="earn-main"><div class="tasks-list" id="tasksList"></div></div>`;
      document.getElementById('main-content').innerHTML = html;
      db.ref('tasks').once('value').then(snap=>{
        let tasks = snap.val()||{};
        let html = '';
        Object.keys(tasks).forEach(tid=>{
          let t = tasks[tid];
          let completed = userData.completedTasks&&userData.completedTasks[tid];
          html += `<div class="task-card">
            <img src="${t.photo}" class="task-photo" />
            <div class="task-info">
              <div class="task-title">${t.name}</div>
              <div class="task-amount">Earn: ${t.amount} SHB</div>
            </div>
            <button class="task-btn ${completed?'completed':''}" data-tid="${tid}">${completed?'Completed':'Start'}</button>
          </div>`;
        });
        document.getElementById('tasksList').innerHTML = html;
        document.querySelectorAll('.task-btn').forEach(btn=>{
          btn.onclick = function(){
            let tid = this.dataset.tid;
            if(userData.completedTasks&&userData.completedTasks[tid]){
              window.open(tasks[tid].link, '_blank');
              return;
            }
            coinsEarned += parseInt(tasks[tid].amount);
            if(!userData.completedTasks) userData.completedTasks={};
            userData.completedTasks[tid]=true;
            updateUserData({balance:coinsEarned,completedTasks:userData.completedTasks});
            notify(`+${tasks[tid].amount} SHB for completing task!`);
            renderTasks();
            window.open(tasks[tid].link, '_blank');
          };
        });
      });
    }

    // Profile Section
    function renderProfile(){
      let html = `<div class="profile-main">
        <div class="avatar-box">
          <img src="${userData.avatar}" class="avatar-img" alt="Avatar"/>
          <div>
            <div class="userid-box">
              <span class="userid">ID: ${userId}</span>
              <button class="copy-btn" id="copyUidBtn"><img src="https://github.com/s42144/Shark-Bounty/blob/177e7fb2815726b7d9710a58dccafff013e0a531/1622069.png?raw=true" /></button>
            </div>
          </div>
        </div>
        <form class="ton-form" onsubmit="return false;">
          <input class="ton-input" id="tonInput" placeholder="Enter TON Wallet Address" value="${userData.ton||''}" />
          <button class="ton-save-btn" id="tonSaveBtn">Save</button>
        </form>
        <div class="referral-section">
          <div style="font-weight:bold;margin-bottom:6px;">Referrals</div>
          <div class="ref-link-box">
            <span class="ref-link" id="refLink">https://t.me/SharkBountybot?start=r_users${userId}</span>
            <button class="ref-copy-btn" id="refCopyBtn"><img src="https://github.com/s42144/Shark-Bounty/blob/177e7fb2815726b7d9710a58dccafff013e0a531/1622069.png?raw=true" /></button>
          </div>
          <div class="ref-counts">
            <span>Total Referrals: <b id="refCount">${referrals.count}</b></span>
            <span>Eject Referrals: <b id="ejectCount">${referrals.eject}</b></span>
          </div>
        </div>
      </div>`;
      document.getElementById('main-content').innerHTML = html;
      document.getElementById('copyUidBtn').onclick = function(){
        navigator.clipboard.writeText(userId).then(()=>notify('User ID copied!'));
      };
      document.getElementById('refCopyBtn').onclick = function(){
        navigator.clipboard.writeText(document.getElementById('refLink').textContent).then(()=>notify('Referral link copied!'));
      };
      document.getElementById('tonSaveBtn').onclick = function(){
        let val = document.getElementById('tonInput').value.trim();
        if(val.length<10){notify('Invalid TON wallet!');return;}
        updateUserData({ton:val});
        notify('TON wallet saved!');
      };
    }

    // Ranking Section
    function renderRanking(){
      document.getElementById('main-content').innerHTML = `<div class="ranking-main">
        <div style="font-weight:bold;margin-bottom:10px;">Top 200 Users by SHB Balance</div>
        <div class="ranking-list" id="rankingList"></div>
      </div>`;
      db.ref('users').orderByChild('balance').limitToLast(200).once('value').then(snap=>{
        let arr = [];
        snap.forEach(child=>arr.push({id:child.key,shb:child.val().balance||0}));
        arr.sort((a,b)=>b.shb-a.shb);
        let html = '';
        arr.forEach((row,i)=>{
          html += `<div class="ranking-row">
            <span class="ranking-pos">${i+1}</span>
            <span class="ranking-userid">ID: ${row.id}</span>
            <span class="ranking-shb">${row.shb} SHB</span>
          </div>`;
        });
        document.getElementById('rankingList').innerHTML = html;
      });
    }

    // Redeem Section
    function renderRedeem(){
      document.getElementById('main-content').innerHTML = `<div class="redeem-main">
        <div class="redeem-box">
          <input class="redeem-input" id="redeemInput" maxlength="4" placeholder="Enter 4-digit code" />
          <button class="redeem-btn" id="redeemBtn">Redeem</button>
        </div>
      </div>`;
      document.getElementById('redeemBtn').onclick = function(){
        let code = document.getElementById('redeemInput').value.trim();
        if(code.length!==4){notify('Enter valid 4-digit code!');return;}
        db.ref('redeemCodes/'+code).once('value').then(snap=>{
          if(snap.exists()){
            coinsEarned+=500;
            updateUserData({balance:coinsEarned});
            db.ref('redeemCodes/'+code).remove();
            notify('+500 SHB redeemed!');
            renderRedeem();
          }else{
            notify('Invalid or already used code!');
          }
        });
      };
    }

    // Navigation
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.onclick = function(){
        showTab(btn.dataset.tab);
      }
    });

    // Start App after Video
    document.getElementById('intro-video').addEventListener('ended',()=>{
      document.getElementById('intro-video').style.display='none';
      document.getElementById('app').style.display='block';
      loadUserData();
    });
    // For fallback if video is very short or errored
    document.getElementById('intro-video').addEventListener('error',()=>{
      document.getElementById('intro-video').style.display='none';
      document.getElementById('app').style.display='block';
      loadUserData();
    });

    // If user reloads or revisits
    window.onload = function(){
      if(document.getElementById('intro-video').ended||document.getElementById('intro-video').style.display==='none'){
        document.getElementById('intro-video').style.display='none';
        document.getElementById('app').style.display='block';
        loadUserData();
      }
    }
  </script>
</body>
</html>
