<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shark Bounty</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" type="image/png" href="17510103.gif">
  <style>
    :root {
      --main-bg: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
      --accent: #00ffe7;
      --accent2: #ff61c9;
      --energy: linear-gradient(90deg, #ffcc70 0%, #ff61c9 100%);
      --card-bg: rgba(22, 31, 56, 0.95);
      --card-shadow: 0 6px 24px rgba(0,0,0,0.25);
      --btn-bg: linear-gradient(90deg, #00ffe7 0%, #ff61c9 100%);
      --btn-txt: #fff;
      --coin-circle: linear-gradient(135deg, #00ffe7 60%, #ff61c9 100%);
      --border: #222b3a;
      --danger: #ff556b;
      --success: #15e58a;
      --grey: #b0b7c3;
      --white: #fff;
      --usdt: #25ba7b;
      --ton: #179fff;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: var(--main-bg);
      color: var(--white);
      min-height: 100vh;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
      overflow-x: hidden;
    }
    body {
      padding-bottom: 72px;
      background: var(--main-bg);
      /* Remove scroll on body and home section */
      overflow: hidden;
    }
    /* Dynamic Island Notification */
    #dynisland-container {
      position: fixed;
      left: 50%;
      top: 13px;
      z-index: 11000;
      transform: translateX(-50%);
      pointer-events: none;
      width: 100vw;
      max-width: 440px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      flex-direction: column;
    }
    .dynisland {
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(22,31,56,0.85);
      border-radius: 34px;
      min-width: 110px;
      max-width: 82vw;
      padding: 13px 30px 13px 30px;
      color: #fff;
      font-size: 1.09em;
      font-weight: 600;
      box-shadow: 0 8px 32px #000b, 0 0px 8px #00ffe760;
      border: 2.5px solid var(--accent);
      opacity: 0;
      pointer-events: none;
      position: relative;
      animation: dynislandin .38s cubic-bezier(.59,1.79,.44,.81) forwards;
      margin: 0 auto;
      margin-bottom: 7px;
      will-change: transform, opacity;
      transition: opacity .4s;
    }
    @keyframes dynislandin {
      0% { opacity: 0; transform: translateY(-35px) scale(0.88);}
      70% { opacity: 1; transform: translateY(7px) scale(1.08);}
      100% { opacity: 1; transform: translateY(0) scale(1);}
    }
    @keyframes dynislandout {
      from { opacity: 1; transform: translateY(0) scale(1);}
      to { opacity: 0; transform: translateY(-30px) scale(0.9);}
    }
    /* Top Bar HIDDEN */
    .top-bar {
      display: none !important;
    }
    .balance-row {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.05rem;
      font-weight: 500;
      margin-bottom: 4px;
      margin-top: 2px;
    }
    .balance-coin {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #143442;
      color: var(--accent);
      border-radius: 15px;
      padding: 4px 10px 4px 7px;
      font-size: 1.09rem;
      font-weight: bold;
      box-shadow: 0 3px 18px #00ffe72c;
      margin-right: 11px;
      min-width: 90px;
    }
    .balance-coin img {
      width: 20px; height: 20px;
    }
    .balance-coin .coin-txt {
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      font-size: 1.04rem;
    }
    .balance-coin .coin-amt {
      margin-left: 7px;
      font-size: 1.08rem;
      font-weight: 600;
      letter-spacing: 1px;
      color: var(--white);
      text-shadow: 0 2px 8px #00ffe7b0;
    }
    .balance-usdt {
      display: flex;
      align-items: center;
      gap: 5px;
      background: #1d2832;
      color: var(--usdt);
      border-radius: 15px;
      padding: 4px 10px 4px 7px;
      font-size: 1.02rem;
      font-weight: bold;
      box-shadow: 0 3px 18px #25ba7b26;
      min-width: 90px;
    }
    .balance-usdt img {
      width: 18px; height: 18px;
    }
    .balance-usdt .usdt-txt {
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      font-weight: 600;
    }
    .balance-usdt .usdt-amt {
      margin-left: 7px;
      font-size: 1.08rem;
      font-weight: 600;
      letter-spacing: 1px;
      color: var(--white);
      text-shadow: 0 2px 8px #25ba7b7a;
    }
    /* Home UI */
    #home-ui {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      animation: fadein 0.8s;
      overflow: hidden;
      height: calc(100vh - 146px);
      position: relative;
      /* prevent scroll on home section */
      overscroll-behavior: none;
      touch-action: none;
    }
    @keyframes fadein { from { opacity: 0 } to { opacity: 1 } }
    .coin-tapper-outer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100vw;
      max-width: 480px;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      pointer-events: none;
    }
    .coin-tapper {
      width: 230px;
      height: 230px;
      border-radius: 50%;
      background: var(--coin-circle);
      box-shadow: 0 7px 60px #00ffe7b0, 0 3px 24px #ff61c980;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 8px solid #1b2d3f;
      margin-bottom: 18px;
      position: relative;
      transition: box-shadow .15s;
      overflow: hidden;
      user-select: none;
      animation: coin-bounce 0.9s infinite alternate cubic-bezier(.53,1.84,.5,1.08);
      pointer-events: auto;
    }
    @keyframes coin-bounce {
      from { transform: scale(1) }
      to { transform: scale(1.06) }
    }
    .coin-tapper img {
      width: 170px;
      height: 170px;
      border-radius: 50%;
      object-fit: cover;
      background: #050e16;
      box-shadow: 0 2px 24px #00ffe766;
      border: 6px solid #fff7;
      z-index: 2;
      transition: transform .1s;
    }
    .coin-tapper:active img {
      transform: scale(1.08);
    }
    .tap-plus-anim {
      position: absolute;
      left: 50%;
      top: 43%;
      transform: translate(-50%, -50%);
      font-size: 2.45rem;
      font-weight: bold;
      color: var(--accent2);
      text-shadow: 0 5px 16px #ff61c9cc, 0 1px 2px #111;
      pointer-events: none;
      opacity: 0;
      animation: tapplus .7s forwards;
      z-index: 9;
      letter-spacing: 1.5px;
    }
    @keyframes tapplus {
      0% { opacity: 1; transform: translate(-50%,-50%) scale(1.1);}
      70% { opacity: 1; transform: translate(-50%,-70%) scale(1.25);}
      100% { opacity: 0; transform: translate(-50%,-120%) scale(0.6);}
    }
    .energy-bar-outer {
      width: 86vw;
      max-width: 310px;
      height: 22px;
      background: #142030;
      border-radius: 18px;
      margin: 8px 0 0 0;
      box-shadow: 0 2px 8px #ff61c94d;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      overflow: hidden;
    }
    .energy-bar-inner {
      height: 100%;
      background: var(--energy);
      border-radius: 18px;
      transition: width .3s cubic-bezier(.7,1.5,.7,.9);
      will-change: width;
      box-shadow: 0 2px 10px #fff5, 0 1px 4px #ffcc7066;
    }
    .energy-bar-icon {
      position: absolute;
      right: 6px;
      top: 50%;
      transform: translateY(-50%);
      height: 22px;
      width: 22px;
    }
    .energy-label {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      font-size: 1.11rem;
      font-weight: bold;
      color: #2a2;
      text-shadow: 0 2px 12px #ffcc7073, 0 1px 2px #222;
      user-select: none;
      z-index: 2;
    }
    .home-float-btn {
      position: fixed;
      top: 50%;
      right: 1vw;
      z-index: 3000;
      transform: translateY(-100%);
      display: flex;
      flex-direction: column;
      gap: 18px;
      pointer-events: auto;
    }
    .home-float-btn button {
      background: var(--btn-bg);
      color: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 16px #00ffe77a;
      border: none;
      width: 60px;
      height: 60px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 1.1em;
      margin-bottom: 3px;
      transition: box-shadow .15s, background .18s;
      position: relative;
      outline: none;
    }
    .home-float-btn button img {
      width: 36px;
      height: 36px;
    }
    .home-float-btn span {
      font-size: 0.91em;
      color: #fff;
      font-weight: 600;
      text-shadow: 0 2px 7px #00ffe7a0;
      position: absolute;
      bottom: -19px;
      left: 50%;
      transform: translateX(-50%);
      width: max-content;
      background: #122e29;
      border-radius: 8px;
      padding: 0 9px;
      white-space: nowrap;
      font-size: 0.96em;
      pointer-events: none;
    }
    /* Fix for float text visibility */
    @media (max-width: 420px) {
      .home-float-btn button span {
        font-size: 0.82em;
        padding: 0 3px;
      }
    }
    /* Bottom nav */
    .bottom-nav { /* unchanged */ }
    .nav-btn { /* unchanged */ }
    .nav-btn.active { /* unchanged */ }
    .nav-btn img { /* unchanged */ }
    /* ... rest unchanged ... */
    /* Profile UI */
    #profile-ui {
      display: none;
      flex-direction: column;
      align-items: center;
      min-height: 400px;
      animation: fadein 0.8s;
      width: 100%;
    }
    .profile-card {
      margin: 18px 0 10px 0;
      padding: 20px 18px;
      border-radius: 18px;
      background: var(--card-bg);
      box-shadow: var(--card-shadow);
      min-width: 210px;
      max-width: 340px;
      width: 90vw;
      position: relative;
    }
    .profile-avatar {
      width: 84px;
      height: 84px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent2);
      margin: 0 auto 10px auto;
      display: block;
      background: #fff;
      box-shadow: 0 2px 18px #ff61c985;
    }
    .profile-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 7px;
      font-size: 1.09rem;
      font-weight: 500;
    }
    .profile-label {
      font-size: 1.05rem;
      color: #17f3a9;
      min-width: 85px;
    }
    .profile-val {
      font-weight: 600;
      color: #fff;
      font-size: 1.09rem;
    }
    .profile-id-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .profile-id-label {
      font-size: 1.05rem;
      color: #ff61c9;
      font-weight: 600;
    }
    .profile-id-value {
      font-family: monospace;
      color: #fff;
      font-size: 1.08rem;
      background: #183c31;
      border-radius: 8px;
      padding: 2px 10px;
    }
    .profile-actions {
      margin: 18px 0 4px 0;
      display: flex;
      flex-direction: column;
      gap: 9px;
      width: 100%;
    }
    .profile-action-btn {
      padding: 9px 0;
      border-radius: 12px;
      background: var(--btn-bg);
      color: var(--btn-txt);
      font-size: 1.04rem;
      font-weight: 600;
      letter-spacing: 1px;
      border: none;
      box-shadow: 0 2px 12px #00ffe733;
      cursor: pointer;
      width: 100%;
      transition: background .18s;
      display: flex;
      align-items: center;
      gap: 7px;
      justify-content: center;
    }
    .profile-action-btn img {
      width: 22px;
      height: 22px;
    }
    .profile-field-row {
      margin-top: 9px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .profile-field-label {
      color: var(--accent);
      font-size: 1.04em;
      min-width: 98px;
      font-weight: 600;
    }
    .profile-field-input {
      flex: 1;
      background: #1a2133;
      color: #fff;
      border: 1.5px solid #28324d;
      border-radius: 8px;
      padding: 7px 10px;
      font-size: 1.04em;
      font-family: inherit;
      outline: none;
      transition: border .13s;
    }
    .profile-field-input:focus {
      border: 1.5px solid var(--accent2);
    }
    .profile-field-save {
      background: var(--btn-bg);
      color: #fff;
      border-radius: 7px;
      border: none;
      font-size: 0.98em;
      padding: 6px 13px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 8px #00ffe745;
      margin-left: 3px;
      transition: background .14s;
    }
    .profile-field-save:active { background: linear-gradient(90deg, #ff61c9 0%, #00ffe7 100%);}
    /* ... rest unchanged ... */
  </style>
</head>
<body>
  <!-- Dynamic Island Notification -->
  <div id="dynisland-container"></div>
  <!-- LOADING SCREEN -->
  <div id="loading-screen">
    <video src="29f4182c-fb84-4f6e-830f-f560ae571afe.mp4" autoplay muted playsinline loop></video>
  </div>
  <div id="app">
    <!-- Top Bar REMOVED -->
    <div style="margin: 0 17px 10px 17px;">
      <div class="balance-row">
        <div class="balance-coin"><img src="17510103.gif"/><span class="coin-txt">SHB</span> <span id="shb-balance" class="coin-amt">0</span></div>
        <div class="balance-usdt"><img src="15207964.png"/><span class="usdt-txt">USDT</span> <span id="usdt-balance" class="usdt-amt">0.00</span></div>
      </div>
    </div>
    <!-- HOME UI -->
    <div id="home-ui" style="position:relative;">
      <div class="coin-tapper-outer">
        <div class="coin-tapper" id="coin-tapper">
          <img src="17510103.gif" alt="Shark Coin"/>
          <span class="tap-plus-anim" id="tap-plus-anim"></span>
        </div>
        <div class="energy-bar-outer">
          <div class="energy-bar-inner" id="energy-bar-inner"></div>
          <div class="energy-label" id="energy-label">Energy: 1200</div>
          <img src="934817.png" class="energy-bar-icon" alt="Energy"/>
        </div>
      </div>
      <div class="home-float-btn" id="home-float-btns">
        <button onclick="showProfileModal('dci')" title="Daily Check In"><img src="1142792.png"/><span>Daily Check-in</span></button>
        <button onclick="showProfileModal('redeem')" title="Redeem"><img src="3179668.png"/><span>Redeem</span></button>
      </div>
    </div>
    <!-- TRADE UI -->
    <div id="trade-ui">
      <div class="plans-list" id="plans-list"></div>
    </div>
    <!-- TASKS UI -->
    <div id="tasks-ui">
      <div style="margin-top: 44px;">
        <img src="16104409.png" style="width:65px;opacity:0.7;">
        <div style="margin-top: 14px; font-size:1.1rem;">No tasks available right now.</div>
        <div style="color:#789; font-size:0.98rem;">(Admin panel will provide tasks soon.)</div>
      </div>
    </div>
    <!-- WALLET UI -->
    <div id="wallet-ui">
      <div class="wallet-tabs">
        <button class="wallet-tab" id="deposit-tab">Deposit</button>
        <button class="wallet-tab" id="withdraw-tab">Withdraw</button>
        <button class="wallet-tab" id="history-tab">History</button>
      </div>
      <div class="wallet-section" id="deposit-section"></div>
      <div class="wallet-section" id="withdraw-section"></div>
      <div class="history-list" id="history-section"></div>
    </div>
    <!-- PROFILE UI -->
    <div id="profile-ui">
      <div class="profile-card">
        <img src="18827926.png" class="profile-avatar"/>
        <div class="profile-row"><span class="profile-label">Username:</span><span class="profile-val" id="profile-username">SharkUser</span></div>
        <div class="profile-row"><span class="profile-label">Referral:</span><span class="profile-val" id="profile-referral">None</span></div>
        <div class="profile-row"><span class="profile-label">Joined:</span><span class="profile-val" id="profile-joined">2025-09-16</span></div>
        <div class="profile-id-row"><span class="profile-id-label">User ID:</span><span class="profile-id-value" id="profile-userid"></span>
          <button class="copy-btn" onclick="copy(document.getElementById('profile-userid').textContent)" title="Copy User ID"><img src="1622069.png"></button>
        </div>
        <!-- TON wallet binding -->
        <div class="profile-field-row">
          <span class="profile-field-label">TON Address:</span>
          <input class="profile-field-input" id="profile-tonaddr" type="text" placeholder="Bind your TON wallet">
          <button class="profile-field-save" onclick="saveProfileField('tonaddr')">Save</button>
        </div>
        <!-- Email binding -->
        <div class="profile-field-row">
          <span class="profile-field-label">Email:</span>
          <input class="profile-field-input" id="profile-email" type="email" placeholder="Bind your email">
          <button class="profile-field-save" onclick="saveProfileField('email')">Save</button>
        </div>
        <div class="profile-actions">
          <button class="profile-action-btn" onclick="showProfileModal('referral')"><img src="17675714.png">Referrals</button>
          <button class="profile-action-btn" onclick="showProfileModal('leaderboard')"><img src="19026492.png">Leaderboard</button>
          <button class="profile-action-btn" onclick="showProfileModal('notification')"><img src="13146658.png">Notification</button>
        </div>
      </div>
    </div>
    <!-- BOTTOM NAV -->
    <div class="bottom-nav" id="bottom-nav">
      <button class="nav-btn active" data-nav="home"><img src="1057118.png"/><span>Home</span></button>
      <button class="nav-btn" data-nav="trade"><img src="9084248.png"/><span>Trade</span></button>
      <button class="nav-btn" data-nav="tasks"><img src="16104409.png"/><span>Tasks</span></button>
      <button class="nav-btn" data-nav="wallet"><img src="6826311.png"/><span>Wallet</span></button>
      <button class="nav-btn" data-nav="profile"><img src="18827926.png"/><span>Profile</span></button>
    </div>
    <!-- MODALS / REDEEM PAGE -->
    <div id="profile-modal-anchor"></div>
    <div id="redeem-page"></div>
  </div>
  <script>
    // --- Constants ---
    const ENERGY_MAX = 1200, ENERGY_PER_TAP = 1, ENERGY_REFILL_PER_SEC = 1;
    const PLANS = [
      { id:'ton', name:'TON/USDT', price:10, validity:30, daily:1, img:'1142792.png' },
      { id:'not', name:'NOT/USDT', price:30, validity:30, daily:3, img:'1142792.png' },
      { id:'hmstr', name:'HMSTR/USDT', price:70, validity:30, daily:7, img:'1142792.png' },
      { id:'eth', name:'ETH/USDT', price:100, validity:30, daily:10, img:'1142792.png' },
      { id:'bnb', name:'BNB/USDT', price:150, validity:30, daily:15, img:'1142792.png' },
      { id:'btc', name:'BTC/USDT', price:200, validity:30, daily:20, img:'1142792.png' }
    ];
    const DEPOSIT_TON_ADDR = "UQCOL7arveEVrKfKa9v3SbZnKjIBnOavmX3aXdDV-XD1cQ09";
    const DEPOSIT_USDT_ADDR = "UQCOL7arveEVrKfKa9v3SbZnKjIBnOavmX3aXdDV-XD1cQ09";
    const TON_QR = "https://github.com/s42144/Shark-Bounty/raw/1890e18b5008f67e6d057aa7a47149bfc84740fc/Screenshot_2025-09-12-18-54-13-944_com.ton_keeper-edit.jpg";
    const USDT_QR = "https://github.com/s42144/Shark-Bounty/raw/a23720d6a315d2422e3943aa7bf779beac9acdad/Screenshot_2025-09-12-18-54-50-676_com.ton_keeper-edit.jpg";
    const TON_RATE = 3.20; // 1 TON = 3.20 USD

    // --- Storage ---
    function getState() {
      try {
        return JSON.parse(localStorage.getItem('sb-state')) || {};
      } catch {return {};}
    }
    function saveState(st) {
      localStorage.setItem('sb-state', JSON.stringify(st));
    }
    let state = getState();
    if (!state.shb) state.shb = 0;
    if (!state.usdt) state.usdt = 0;
    if (!state.energy) state.energy = ENERGY_MAX;
    if (!state.lastEnergyTs) state.lastEnergyTs = Date.now();
    if (!state.plans) state.plans = {};
    if (!state.history) state.history = [];
    if (!state.notifications) state.notifications = [];
    if (!state.dci) state.dci = { last: null, streak: 0, progress: [false,false,false,false,false,false,false] };
    if (!state.userid) state.userid = (Math.floor(Math.random()*1e11)).toString().padStart(11,'0');
    if (!state.tonaddr) state.tonaddr = "";
    if (!state.email) state.email = "";
    saveState(state);

    // --- Dynamic Island Notification ---
    function showDynamicIsland(msg) {
      const c = document.getElementById('dynisland-container');
      let el = document.createElement('div');
      el.className = 'dynisland';
      el.innerHTML = msg;
      c.appendChild(el);
      setTimeout(()=>{el.style.opacity=1;},10);
      setTimeout(()=>{
        el.style.animation = 'dynislandout .6s forwards';
        setTimeout(()=>{el.remove();},600);
      }, 2000);
    }
    // Patch addNotification to use dynamic island
    function addNotification(txt) {
      state.notifications = state.notifications||[];
      state.notifications.push({text:txt,date:new Date().toLocaleString()});
      if (state.notifications.length>100) state.notifications.shift();
      saveState(state);
      showDynamicIsland(txt);
    }

    // --- Loading screen ---
    setTimeout(()=>{
      document.getElementById('loading-screen').style.opacity=0;
      setTimeout(()=>{
        document.getElementById('loading-screen').style.display='none';
        document.getElementById('app').style.display='flex';
        navTo('home');
        updateBalances();
        updateEnergyBar();
        renderPlans();
        renderHistory();
        document.getElementById('profile-userid').textContent = state.userid;
        // Load bind fields for profile
        if (state.tonaddr) document.getElementById('profile-tonaddr').value = state.tonaddr;
        if (state.email) document.getElementById('profile-email').value = state.email;
      },500);
    },1800);

    // --- Navigation ---
    let navBtns = document.querySelectorAll('.nav-btn');
    navBtns.forEach(btn=>{
      btn.onclick = ()=> {
        navBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        navTo(btn.dataset.nav);
      }
    });
    // Remove all page headings: just don't render any
    function navTo(nav) {
      document.getElementById('home-ui').style.display = nav==='home' ? 'flex' : 'none';
      document.getElementById('trade-ui').style.display = nav==='trade' ? 'flex' : 'none';
      document.getElementById('tasks-ui').style.display = nav==='tasks' ? 'flex' : 'none';
      document.getElementById('wallet-ui').style.display = nav==='wallet' ? 'flex' : 'none';
      document.getElementById('profile-ui').style.display = nav==='profile' ? 'flex' : 'none';
      if (nav==='profile') {
        document.getElementById('profile-userid').textContent = state.userid;
        if (state.tonaddr) document.getElementById('profile-tonaddr').value = state.tonaddr;
        if (state.email) document.getElementById('profile-email').value = state.email;
      }
      if (nav==='wallet') showWalletTab('none');
    }

    // --- Profile bind/save fields
    function saveProfileField(field) {
      let input, key;
      if (field==='tonaddr') {
        input = document.getElementById('profile-tonaddr');
        key = 'tonaddr';
      } else if (field==='email') {
        input = document.getElementById('profile-email');
        key = 'email';
      }
      const val = input.value.trim();
      state[key] = val;
      saveState(state);
      showDynamicIsland(key==='tonaddr' ? "TON address saved" : "Email saved");
    }
    window.saveProfileField = saveProfileField;

    // --- Balances ---
    function updateBalances() {
      document.getElementById('shb-balance').innerHTML = state.shb;
      document.getElementById('usdt-balance').innerHTML = parseFloat(state.usdt).toFixed(2);
    }

    // --- Coin Tapper ---
    let energy = state.energy, lastEnergyTs = state.lastEnergyTs;
    let tapAnimTimeout = null;
    function updateEnergyBar() {
      let now = Date.now();
      let diff = Math.floor((now - lastEnergyTs)/1000);
      if (energy<ENERGY_MAX && diff>0) {
        energy += diff*ENERGY_REFILL_PER_SEC;
        if (energy>ENERGY_MAX) energy=ENERGY_MAX;
        lastEnergyTs = now;
        state.energy=energy; state.lastEnergyTs=lastEnergyTs; saveState(state);
      }
      let perc = Math.floor(energy/ENERGY_MAX*100);
      document.getElementById('energy-bar-inner').style.width = perc+"%";
      document.getElementById('energy-label').textContent = "Energy: "+energy;
    }
    setInterval(()=>{
      updateEnergyBar();
    },1000);

    document.getElementById('coin-tapper').onclick = ()=>{
      if (energy < ENERGY_PER_TAP) {
        let anim = document.getElementById('tap-plus-anim');
        anim.innerHTML = `<span style="color:#ff556b;">No Energy!</span>`;
        anim.style.opacity=1;
        clearTimeout(tapAnimTimeout);
        tapAnimTimeout = setTimeout(()=>{anim.style.opacity=0},700);
        return;
      }
      state.shb = (state.shb||0) + 1;
      energy -= ENERGY_PER_TAP;
      if (energy<0) energy=0;
      state.energy=energy; state.lastEnergyTs=Date.now();
      saveState(state);
      updateBalances();
      updateEnergyBar();
      // Animation
      let anim = document.getElementById('tap-plus-anim');
      anim.textContent = "+1";
      anim.style.opacity=1;
      anim.style.animation = 'none'; anim.offsetHeight; anim.style.animation = null;
      clearTimeout(tapAnimTimeout);
      tapAnimTimeout = setTimeout(()=>{anim.style.opacity=0},700);
      addNotification("You earned 1 SHB by tapping the shark coin!");
    };

    // --- Plans (Trade) ---
    function renderPlans() {
      let plansEl = document.getElementById('plans-list');
      plansEl.innerHTML = '';
      PLANS.forEach(plan=>{
        let userPlan = state.plans[plan.id]||{};
        let active = !!userPlan.purchased;
        let canClaim = active && Date.now() - (userPlan.lastClaim||0) > 24*3600*1000;
        let expired = active && Date.now() > userPlan.purchased + plan.validity*24*3600*1000;
        let btnTxt = !active ? 'Buy' : (canClaim ? 'Claim' : 'Claimed');
        let disabled = active && !canClaim;
        let row = document.createElement('div');
        row.className = 'plan-card';
        row.innerHTML = `
          <div class="plan-title">
            ${plan.name}
            <img src="2592317.png" class="plan-secure" title="Secure"/>
          </div>
          <div class="plan-row">
            <span class="plan-price"><img src="15207964.png" style="width:18px;vertical-align:middle;margin-right:2px;">$${plan.price}</span>
            <span class="plan-validity">Validity: ${plan.validity} days</span>
            <span class="plan-earning">Daily: $${plan.daily}</span>
          </div>
          <button class="${!active?'buy-btn':'claim-btn'}" ${disabled?'disabled':''} data-plan="${plan.id}">${btnTxt}</button>
        `;
        row.querySelector('button').onclick = ()=>{
          if (!active) buyPlan(plan);
          else if (canClaim) claimPlan(plan);
        };
        plansEl.appendChild(row);
      });
    }
    function buyPlan(plan) {
      if (state.usdt < plan.price) {
        alert("Insufficient USDT balance.");
        return;
      }
      if (state.plans[plan.id] && state.plans[plan.id].purchased) {
        alert("Plan already active.");
        return;
      }
      if (!confirm(`Buy ${plan.name} plan for $${plan.price}?`)) return;
      state.usdt -= plan.price;
      state.plans[plan.id]={purchased:Date.now(), lastClaim:0};
      state.history.push({type:'buy',plan:plan.name,amt:plan.price,date:new Date().toLocaleString()});
      saveState(state);
      updateBalances();
      renderPlans();
      renderHistory();
      addNotification(`Bought ${plan.name} plan for $${plan.price}`);
      alert("Plan purchased successfully!");
    }
    function claimPlan(plan) {
      let userPlan = state.plans[plan.id];
      if (!userPlan) return;
      let now = Date.now();
      if (now - (userPlan.lastClaim||0) < 24*3600*1000) {
        alert("Already claimed today.");
        return;
      }
      state.usdt += plan.daily;
      userPlan.lastClaim = now;
      state.plans[plan.id]=userPlan;
      state.history.push({type:'claim',plan:plan.name,amt:plan.daily,date:new Date().toLocaleString()});
      saveState(state);
      updateBalances();
      renderPlans();
      renderHistory();
      addNotification(`Claimed $${plan.daily} daily earning from ${plan.name} plan!`);
      alert(`Claimed $${plan.daily} for ${plan.name}!`);
    }

    // --- WALLET TAB ---
    document.getElementById('deposit-tab').onclick = ()=>showWalletTab('deposit');
    document.getElementById('withdraw-tab').onclick = ()=>showWalletTab('withdraw');
    document.getElementById('history-tab').onclick = ()=>showWalletTab('history');
    function showWalletTab(tab) {
      document.getElementById('deposit-section').classList.remove('active');
      document.getElementById('withdraw-section').classList.remove('active');
      document.getElementById('history-section').classList.remove('active');
      document.getElementById('deposit-tab').classList.remove('active');
      document.getElementById('withdraw-tab').classList.remove('active');
      document.getElementById('history-tab').classList.remove('active');
      if (tab==='deposit') {
        document.getElementById('deposit-section').classList.add('active');
        document.getElementById('deposit-tab').classList.add('active');
        renderDeposit();
      }
      else if (tab==='withdraw') {
        document.getElementById('withdraw-section').classList.add('active');
        document.getElementById('withdraw-tab').classList.add('active');
        renderWithdraw();
      }
      else if (tab==='history') {
        document.getElementById('history-section').classList.add('active');
        document.getElementById('history-tab').classList.add('active');
        renderHistory();
      }
    }
    showWalletTab('none');

    // Deposit Section
    function renderDeposit() {
      let el = document.getElementById('deposit-section');
      el.innerHTML = `
        <div class="wallet-info-box">
          <b>Deposit USDT or TON into your wallet:</b><br>
          - Minimum TON amount is <b>3</b><br>
          - Minimum USDT amount is <b>10</b><br>
          - Use the correct wallet address and memo.<br>
          - Deposits are credited after confirmation.
        </div>
        <div class="form-row">
          <label>Deposit Method</label>
          <select id="deposit-method">
            <option value="ton"><img src="934817.png" class="wallet-method-img" /> TONCOIN</option>
            <option value="usdt"><img src="15207964.png" class="wallet-method-img" /> USDT TON</option>
          </select>
        </div>
        <div class="form-row" id="deposit-amount-row">
          <label id="deposit-amt-label"><img src="934817.png" class="wallet-method-img" /> TON Amount (min 3)</label>
          <input type="number" id="deposit-amount" min="3" placeholder="Enter TON amount"/>
        </div>
        <button class="buy-btn" id="deposit-confirm-btn" style="margin-top:3px;">Proceed</button>
      `;
      let methodSel = el.querySelector('#deposit-method');
      let amtInput = el.querySelector('#deposit-amount');
      let amtLabel = el.querySelector('#deposit-amt-label');
      let confirmBtn = el.querySelector('#deposit-confirm-btn');
      function updateLabel() {
        let m = methodSel.value;
        amtLabel.innerHTML = m==='ton'
          ? `<img src="934817.png" class="wallet-method-img" /> TON Amount (min 3)`
          : `<img src="15207964.png" class="wallet-method-img" /> USDT Amount (min 10)`;
        amtInput.placeholder = m==='ton' ? "Enter TON amount" : "Enter USDT amount";
        amtInput.min = m==='ton' ? 3 : 10;
      }
      methodSel.onchange = updateLabel;
      updateLabel();
      confirmBtn.onclick = ()=>{
        let m = methodSel.value;
        let amt = parseFloat(amtInput.value);
        if (isNaN(amt) || amt < (m==='ton'?3:10)) {
          alert(`Minimum ${m==='ton'?'3 TON':'10 USDT'} required.`);
          return;
        }
        showDepositQR(m, amt);
      };
    }
    function showDepositQR(method, amt) {
      let el = document.getElementById('deposit-section');
      let addr = method==='ton'?DEPOSIT_TON_ADDR:DEPOSIT_USDT_ADDR;
      let qr = method==='ton'?TON_QR:USDT_QR;
      let memo = randomMemo();
      let usdtVal = method==='ton'?amt*TON_RATE:amt;
      let expire = Date.now()+15*60*1000;
      let timerId;
      function countdown() {
        let left = Math.max(0, Math.floor((expire-Date.now())/1000));
        let m = Math.floor(left/60), s = left%60;
        el.querySelector('.deposit-countdown').textContent = `Expires in: ${m}m ${s}s`;
        if (left <= 0) {
          clearInterval(timerId);
          el.innerHTML = `<div style="color:#ff556b; font-size:1.07rem;">Deposit session expired.<br><button class="buy-btn" onclick="showWalletTab('deposit')">Back</button></div>`;
        }
      }
      el.innerHTML = `
        <div class="deposit-countdown"></div>
        <div class="qr-section">
          <img src="${qr}" alt="Deposit QR"/>
        </div>
        <div class="deposit-info-box">
          <div class="deposit-address">Address: <span>${addr}</span>
            <button class="copy-btn" onclick="copy('${addr}')" title="Copy Address"><img src="1622069.png"></button>
          </div>
          <div class="deposit-memo">Memo/Comment: <span class="memo-label">${memo}</span>
            <button class="copy-btn" onclick="copy('${memo}')" title="Copy Memo"><img src="1622069.png"></button>
          </div>
          <div class="live-rate">
            You will get: <b>${usdtVal.toFixed(2)} USDT</b>
            <span style="color:#bbb; font-size:0.94rem;display:block;margin-top:3px;">(1 TON = $${TON_RATE.toFixed(2)})</span>
          </div>
        </div>
        <div style="text-align:center;margin-top:9px;">
          <button class="buy-btn" onclick="confirmDeposit('${method}',${amt},'${memo}',${usdtVal})">I have paid</button>
        </div>
      `;
      countdown();
      timerId = setInterval(countdown,1000);
    }
    window.showDepositQR = showDepositQR;
    function confirmDeposit(method, amt, memo, usdtVal) {
      if (!confirm("Payment will be verified and USDT added on success. Add in 5-10s for test!")) return;
      state.usdt += usdtVal;
      state.history.push({type:'deposit',method,amt:usdtVal,date:new Date().toLocaleString(),addr:method==='ton'?DEPOSIT_TON_ADDR:DEPOSIT_USDT_ADDR,memo});
      saveState(state);
      updateBalances();
      renderHistory();
      addNotification(`Deposit success! +${usdtVal.toFixed(2)} USDT`);
      alert("Deposit successful. USDT balance updated!");
      showWalletTab('history');
    }
    window.confirmDeposit = confirmDeposit;

    // Withdraw Section
    function renderWithdraw() {
      let el = document.getElementById('withdraw-section');
      el.innerHTML = `
        <div class="wallet-info-box">
          <b>Withdraw USDT/TON:</b><br>
          - Minimum withdraw amount is <b>$3</b><br>
          - Enter your TON chain address<br>
          - Withdrawals are processed after review.
        </div>
        <div class="form-row">
          <label>Withdraw Method</label>
          <select id="withdraw-method">
            <option value="usdt"><img src="15207964.png" class="wallet-method-img" /> USDT TON</option>
            <option value="ton"><img src="934817.png" class="wallet-method-img" /> TONCOIN</option>
          </select>
        </div>
        <div class="form-row">
          <label>Amount (min $3)</label>
          <input type="number" id="withdraw-amount" min="3" placeholder="Enter amount"/>
        </div>
        <div class="form-row">
          <label>Address (TON chain)</label>
          <input type="text" id="withdraw-address" placeholder="Enter TON chain address"/>
        </div>
        <div class="form-row">
          <label>Memo/Comment (optional)</label>
          <input type="text" id="withdraw-memo" placeholder="Memo/Comment (optional)"/>
        </div>
        <button class="buy-btn" id="withdraw-confirm-btn" style="margin-top:3px;">Withdraw</button>
      `;
      el.querySelector('#withdraw-confirm-btn').onclick = ()=>{
        let method = el.querySelector('#withdraw-method').value;
        let amt = parseFloat(el.querySelector('#withdraw-amount').value);
        let addr = el.querySelector('#withdraw-address').value.trim();
        let memo = el.querySelector('#withdraw-memo').value.trim();
        if (isNaN(amt) || amt < 3) {
          alert("Minimum withdraw $3.");
          return;
        }
        if (!addr) {
          alert("Enter TON chain address.");
          return;
        }
        if (amt > state.usdt) {
          alert("Insufficient USDT balance.");
          return;
        }
        if (!confirm("Confirm withdraw?")) return;
        state.usdt -= amt;
        state.history.push({type:'withdraw',method,amt,date:new Date().toLocaleString(),addr,memo});
        saveState(state);
        updateBalances();
        renderHistory();
        addNotification(`Withdraw request: -$${amt} via ${method}`);
        alert("Withdraw request submitted!");
        showWalletTab('history');
      };
    }

    // History
    function renderHistory() {
      let el = document.getElementById('history-section');
      if (!state.history || !state.history.length) {
        el.innerHTML = `<div style="color:#bbb;text-align:center;">No history found.</div>`;
        return;
      }
      el.innerHTML = '';
      state.history.slice().reverse().forEach(h=>{
        let txt = '';
        if (h.type==='deposit') txt = `<b>Deposit</b> (${h.method}) <span style="color:#17f3a9;">+$${h.amt}</span>`;
        else if (h.type==='withdraw') txt = `<b>Withdraw</b> (${h.method}) <span style="color:#ff556b;">-$${h.amt}</span>`;
        else if (h.type==='buy') txt = `<b>Bought Plan:</b> ${h.plan} <span style="color:#ff61c9;">-$${h.amt}</span>`;
        else if (h.type==='claim') txt = `<b>Claimed:</b> ${h.plan} <span style="color:#17f3a9;">+$${h.amt}</span>`;
        el.innerHTML += `<div class="history-item">
          <div class="history-txt">${txt}</div>
          <div class="history-quote">
            Date: <i>${h.date}</i><br>
            ${h.addr?`Wallet: <i>${h.addr}</i><br>`:""}
            ${h.memo?`Memo: <i>${h.memo}</i><br>`:""}
            ${h.type==='deposit'?"":" "}
          </div>
        </div>`;
      });
    }

    // Copy util
    function copy(txt) {
      navigator.clipboard.writeText(txt);
      showDynamicIsland("Copied!");
    }
    window.copy = copy;

    // Memo generator
    function randomMemo() {
      let s = '';
      let chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ123456789';
      for (let i=0;i<7;i++) s+=chars[Math.floor(Math.random()*chars.length)];
      return s;
    }

    // --- Profile Dummy data ---
    document.getElementById('profile-username').textContent = "SharkUser";
    document.getElementById('profile-referral').textContent = "None";
    document.getElementById('profile-joined').textContent = (new Date()).toISOString().slice(0,10);
    document.getElementById('profile-userid').textContent = state.userid;

    // --- Profile Modal ---
    function showProfileModal(type) {
      let anchor = document.getElementById('profile-modal-anchor');
      anchor.innerHTML = "";
      if (type==='referral') {
        anchor.innerHTML = `<div class="modal-bg" onclick="closeProfileModal(event)">
          <div class="modal-box" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeProfileModal(event)">&times;</button>
            <div style="font-size:1.2em;font-weight:600;margin-bottom:11px;">Referrals</div>
            <div style="padding:17px 4px;text-align:center;">Referral features <span style="color:#17f3a9;">Coming soon!</span></div>
          </div>
        </div>`;
      }
      if (type==='leaderboard') {
        let names = ["Alex", "Sam", "Liam", "Noah", "Mia", "Lucas", "Sophia", "Emma", "Ava", "Ethan", "Olivia", "Mason", "Logan", "James", "Ella", "Jack", "Jacob", "Isabella", "Benjamin", "Elijah"];
        let flags = ["ðŸ‡ºðŸ‡¸", "ðŸ‡¬ðŸ‡§", "ðŸ‡¯ðŸ‡µ", "ðŸ‡®ðŸ‡³", "ðŸ‡¨ðŸ‡¦", "ðŸ‡¦ðŸ‡º", "ðŸ‡«ðŸ‡·", "ðŸ‡©ðŸ‡ª", "ðŸ‡§ðŸ‡·", "ðŸ‡®ðŸ‡¹"];
        function makeUser(rank) {
          let name = names[Math.floor(Math.random()*names.length)];
          let flag = flags[Math.floor(Math.random()*flags.length)];
          let usdt = (Math.floor(Math.random()*800)+100*rank+250).toFixed(2);
          return {rank, name, flag, usdt};
        }
        let rows = [];
        for (let i=0;i<100;i++) rows.push(makeUser(i+1));
        let lbRows = rows.map((u, i)=>`
          <div class="leaderboard-row" style="border-left: 5px solid ${i<3?'#ffcc70':'#00ffe7'};">
            <span class="lb-rank">${u.rank}${i<3?'<img src="19026492.png" class="lb-top" style="width:21px;vertical-align:middle;">':''}</span>
            <span class="lb-flag">${u.flag}</span>
            <span class="lb-name">${u.name}</span>
            <span class="lb-usdt"><img src="15207964.png">${u.usdt} USDT</span>
          </div>
        `).join("");
        anchor.innerHTML = `<div class="modal-bg" onclick="closeProfileModal(event)">
          <div class="modal-box" id="lb-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeProfileModal(event)">&times;</button>
            <div class="leaderboard-title">Leaderboard</div>
            <div style="max-height:64vh;overflow:auto;">
              ${lbRows}
            </div>
          </div>
        </div>`;
        let lbModal = document.getElementById('lb-modal');
        let lbInterval = setInterval(()=>{
          let rows = [];
          for (let i=0;i<100;i++) rows.push(makeUser(i+1));
          lbModal.querySelector('div[max-height]').innerHTML = rows.map((u, i)=>`
            <div class="leaderboard-row" style="border-left: 5px solid ${i<3?'#ffcc70':'#00ffe7'};">
              <span class="lb-rank">${u.rank}${i<3?'<img src="19026492.png" class="lb-top" style="width:21px;vertical-align:middle;">':''}</span>
              <span class="lb-flag">${u.flag}</span>
              <span class="lb-name">${u.name}</span>
              <span class="lb-usdt"><img src="15207964.png">${u.usdt} USDT</span>
            </div>
          `).join("");
        },30000);
        anchor.lbInterval = lbInterval;
      }
      if (type==='dci') {
        let dci = state.dci;
        let today = (new Date()).toDateString();
        let reward = [
          {shb:1000,usdt:0.10},
          {shb:2000,usdt:0.20},
          {shb:3000,usdt:0.30},
          {shb:4000,usdt:0.40},
          {shb:5000,usdt:0.50},
          {shb:6000,usdt:0.60},
          {shb:7000,usdt:0.70}
        ];
        let days = "";
        for (let i=0;i<7;i++) days+=`
          <div class="dci-day${dci.progress[i]?' claimed':''}">
            <span class="dci-day-title">Day ${i+1}</span>
            <span class="dci-reward">${reward[i].shb} SHB<br>${reward[i].usdt} USDT</span>
            ${dci.progress[i]?'<span style="color:#fff;font-size:0.94em;margin-top:5px;font-weight:bold;">Claimed</span>':''}
          </div>`;
        let nextIdx = dci.progress.findIndex(v=>!v);
        let eligible = (dci.last!==(new Date()).toDateString() && nextIdx!==-1);
        let btn = eligible?`<button class="dci-btn" onclick="checkInDci()">Check In</button>`:`<div style="color:#bbb;margin-top:13px;">Checked in today or completed all days.</div>`;
        anchor.innerHTML = `<div class="modal-bg" onclick="closeProfileModal(event)">
          <div class="dci-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeProfileModal(event)">&times;</button>
            <div style="font-size:1.25em;font-weight:700;letter-spacing:1px;color:var(--accent);margin-bottom:9px;position:sticky;top:0;z-index:2;">Daily Check In</div>
            <div class="dci-scroll" style="overflow-x:auto;max-width:370px;">${days}</div>
            ${btn}
            <div class="dci-progress">Current streak: ${dci.progress.filter(v=>v).length}/7</div>
          </div>
        </div>`;
      }
      if (type==='notification') {
        let noti = state.notifications||[];
        let list = noti.length?noti.slice().reverse().map(n=>`
          <div class="noti-item">
            ${n.text}
            <span class="noti-date">${n.date}</span>
          </div>
        `).join(""):`<div style="color:#bbb;text-align:center;">No notifications yet.</div>`;
        anchor.innerHTML = `<div class="modal-bg" onclick="closeProfileModal(event)">
          <div class="noti-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeProfileModal(event)">&times;</button>
            <div class="noti-title" style="position:sticky;top:0;z-index:2;">Notifications</div>
            <div class="noti-list">${list}</div>
          </div>
        </div>`;
      }
      if (type==='redeem') {
        showRedeemPage();
        return;
      }
    }
    window.showProfileModal = showProfileModal;
    function closeProfileModal(e) {
      if(e) e.stopPropagation();
      let anchor = document.getElementById('profile-modal-anchor');
      if (anchor.lbInterval) clearInterval(anchor.lbInterval);
      anchor.innerHTML = "";
      document.getElementById('redeem-page').style.display = "none";
    }
    window.closeProfileModal = closeProfileModal;

    // Daily Check In logic
    function checkInDci() {
      let dci = state.dci;
      let today = (new Date()).toDateString();
      let nextIdx = dci.progress.findIndex(v=>!v);
      let reward = [
        {shb:1000,usdt:0.10},
        {shb:2000,usdt:0.20},
        {shb:3000,usdt:0.30},
        {shb:4000,usdt:0.40},
        {shb:5000,usdt:0.50},
        {shb:6000,usdt:0.60},
        {shb:7000,usdt:0.70}
      ];
      if (nextIdx!==-1 && dci.last!==today) {
        dci.progress[nextIdx]=true;
        dci.last=today;
        state.dci=dci;
        state.shb+=reward[nextIdx].shb;
        state.usdt+=reward[nextIdx].usdt;
        state.notifications = state.notifications||[];
        state.notifications.push({text:`Checked in - ${reward[nextIdx].shb} SHB & ${reward[nextIdx].usdt} USDT added!`,date:new Date().toLocaleString()});
        saveState(state);
        updateBalances();
        renderHistory();
        showProfileModal('dci');
      }
    }
    window.checkInDci = checkInDci;

    // --- Redeem Page ---
    function showRedeemPage() {
      const el = document.getElementById('redeem-page');
      el.style.display = "flex";
      el.innerHTML = `
        <div class="redeem-box">
          <button class="modal-close" style="position:absolute;top:12px;right:13px;" onclick="closeProfileModal(event)">&times;</button>
          <div style="font-size:1.2em;font-weight:600;margin-bottom:11px;position:sticky;top:0;z-index:2;">Redeem</div>
          <form id="redeem-form">
            <div class="redeem-form-row">
              <label>Redemption Code</label>
              <input type="text" id="redeem-code" required placeholder="Enter redemption code"/>
            </div>
            <button class="redeem-btn" type="submit">Redeem</button>
          </form>
          <div id="redeem-success" class="redeem-success"></div>
        </div>
      `;
      el.querySelector('#redeem-form').onsubmit = function(e){
        e.preventDefault();
        let code = el.querySelector('#redeem-code').value.trim();
        if(!code){
          el.querySelector('#redeem-success').innerHTML = `<span style="color:#ff556b;">Please enter a code!</span>`;
          return;
        }
        el.querySelector('#redeem-success').innerHTML = `Your redeem code <b>${code}</b> has been submitted!`;
        addNotification(`Redeem code used: ${code}`);
      }
    }
    window.showRedeemPage = showRedeemPage;

    // --- First tab triggers ---
    showWalletTab('none');
  </script>
</body>
</html>
