<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shark Bounty Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
  <h2>Shark Bounty Admin Panel</h2>
  <div>
    <input id="searchId" placeholder="Enter User ID"/>
    <button onclick="loadUser()">Search User</button>
  </div>
  <div id="userArea"></div>
  <hr>
  <div>
    <h3>Pending Deposits</h3>
    <div id="pendingDeposits"></div>
  </div>
  <hr>
  <div>
    <h3>Pending Withdrawals</h3>
    <div id="pendingWithdraws"></div>
  </div>
  <hr>
  <div>
    <h3>Add/Edit Tasks</h3>
    <input id="taskName" placeholder="Task Name"/>
    <input id="taskImg" placeholder="Image URL"/>
    <input id="taskUrl" placeholder="Task URL"/>
    <input id="taskSHB" placeholder="SHB Reward" type="number"/>
    <input id="taskUSDT" placeholder="USDT Reward" type="number"/>
    <button onclick="addTask()">Add Task</button>
    <div id="tasksList"></div>
  </div>
  <hr>
  <div>
    <h3>Send Notification</h3>
    <input id="notifUserId" placeholder="User ID (leave blank for all)"/>
    <input id="notifText" placeholder="Message"/>
    <button onclick="sendNotification()">Send</button>
  </div>
  <hr>
  <div>
    <h3>Redemption Codes</h3>
    <input id="redCode" placeholder="Code"/>
    <input id="redAmt" placeholder="USDT Amount" type="number"/>
    <input id="redLimit" placeholder="Max Uses" type="number"/>
    <button onclick="addRedemption()">Add Code</button>
    <div id="redemptions"></div>
  </div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "shark-bounty.firebaseapp.com",
      databaseURL: "https://shark-bounty-default-rtdb.firebaseio.com",
      projectId: "shark-bounty",
      storageBucket: "shark-bounty.appspot.com",
      messagingSenderId: "YOUR_MSG_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // User Search and Balance Control
    window.loadUser = function() {
      let id = document.getElementById("searchId").value.trim();
      if (!id) return;
      db.ref("users/"+id).once("value").then(snap=>{
        let user = snap.val();
        if (!user) return document.getElementById("userArea").innerText = "User not found.";
        let html = `
          <b>User ID:</b> ${id}<br>
          <b>SHB:</b> <input id="setSHB" value="${user.shb||0}" size="7"/>
          <button onclick="setBalance('${id}','shb')">Set</button>
          <b>USDT:</b> <input id="setUSDT" value="${user.usdt||0}" size="7"/>
          <button onclick="setBalance('${id}','usdt')">Set</button>
          <div><b>History:</b><pre>${JSON.stringify(user.history||[],null,2)}</pre></div>
        `;
        document.getElementById("userArea").innerHTML = html;
      });
    }
    window.setBalance = (id, type) => {
      let v = document.getElementById(type==="shb"?"setSHB":"setUSDT").value;
      db.ref("users/"+id+"/"+type).set(Number(v));
      alert("Updated!");
    };

    // Pending Deposits
    db.ref("deposits").on("value", snap=>{
      let d = snap.val()||{};
      let html = "";
      for (let k in d) {
        let item = d[k];
        html += `<div>
          <b>User:</b> ${item.userid} <b>Amount:</b> ${item.amount} <b>Status:</b> ${item.status||"pending"}
          <b>Date:</b> ${item.date} <b>Memo:</b> ${item.memo||""}
          <button onclick="approveDeposit('${k}')">Approve</button>
          <button onclick="rejectDeposit('${k}')">Reject</button>
        </div>`;
      }
      document.getElementById("pendingDeposits").innerHTML = html;
    });
    window.approveDeposit = k => {
      db.ref("deposits/"+k).once("value").then(snap=>{
        let d = snap.val();
        db.ref("users/"+d.userid+"/usdt").transaction(val => (val||0)+Number(d.amount));
        db.ref("deposits/"+k+"/status").set("approved");
        db.ref("users/"+d.userid+"/history").push({...d, status:"approved"});
      });
    };
    window.rejectDeposit = k => {
      db.ref("deposits/"+k+"/status").set("rejected");
      db.ref("deposits/"+k).once("value").then(snap=>{
        let d = snap.val();
        db.ref("users/"+d.userid+"/history").push({...d, status:"rejected"});
      });
    };

    // Pending Withdraws
    db.ref("withdraws").on("value", snap=>{
      let d = snap.val()||{};
      let html = "";
      for (let k in d) {
        let item = d[k];
        html += `<div>
          <b>User:</b> ${item.userid} <b>Amount:</b> ${item.amount} <b>Status:</b> ${item.status||"pending"}
          <b>Date:</b> ${item.date} <b>Memo:</b> ${item.memo||""}
          <button onclick="approveWithdraw('${k}')">Approve</button>
          <button onclick="rejectWithdraw('${k}')">Reject</button>
        </div>`;
      }
      document.getElementById("pendingWithdraws").innerHTML = html;
    });
    window.approveWithdraw = k => {
      db.ref("withdraws/"+k).once("value").then(snap=>{
        let d = snap.val();
        db.ref("withdraws/"+k+"/status").set("approved");
        db.ref("users/"+d.userid+"/history").push({...d, status:"approved"});
      });
    };
    window.rejectWithdraw = k => {
      db.ref("withdraws/"+k).once("value").then(snap=>{
        let d = snap.val();
        db.ref("users/"+d.userid+"/usdt").transaction(val => (val||0)+Number(d.amount));
        db.ref("withdraws/"+k+"/status").set("rejected");
        db.ref("users/"+d.userid+"/history").push({...d, status:"rejected"});
      });
    };

    // Tasks
    window.addTask = function() {
      let name = document.getElementById("taskName").value;
      let img = document.getElementById("taskImg").value;
      let url = document.getElementById("taskUrl").value;
      let shb = Number(document.getElementById("taskSHB").value);
      let usdt = Number(document.getElementById("taskUSDT").value);
      let key = db.ref("tasks").push().key;
      db.ref("tasks/"+key).set({name,img,url,shb,usdt});
      alert("Task Added!");
    }
    db.ref("tasks").on("value", snap=>{
      let t = snap.val()||{};
      let html = "";
      for (let k in t) {
        let item = t[k];
        html += `<div><b>${item.name}</b> SHB:${item.shb} USDT:${item.usdt} <a href="${item.url}" target="_blank">Link</a></div>`;
      }
      document.getElementById("tasksList").innerHTML = html;
    });

    // Notifications
    window.sendNotification = function() {
      let uid = document.getElementById("notifUserId").value.trim();
      let msg = document.getElementById("notifText").value;
      if (!msg) return;
      if (uid) db.ref("users/"+uid+"/notifications").push({text:msg, date:new Date().toLocaleString()});
      else db.ref("users").once("value").then(snap=>{
        let users = snap.val()||{};
        for (let id in users) db.ref("users/"+id+"/notifications").push({text:msg, date:new Date().toLocaleString()});
      });
      alert("Notification sent!");
    }

    // Redemption codes
    window.addRedemption = function() {
      let code = document.getElementById("redCode").value.trim();
      let amt = Number(document.getElementById("redAmt").value);
      let limit = Number(document.getElementById("redLimit").value);
      db.ref("redemptions/"+code).set({amount:amt,limit:limit,used:0});
      alert("Redemption code added!");
    }
    db.ref("redemptions").on("value", snap=>{
      let d = snap.val()||{};
      let html = "";
      for (let k in d) {
        let item = d[k];
        html += `<div><b>${k}</b> USDT:${item.amount} Used:${item.used||0}/${item.limit}</div>`;
      }
      document.getElementById("redemptions").innerHTML = html;
    });
  </script>
</body>
</html>
