<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shark Bounty - Professional Admin Panel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <link rel="icon" href="https://github.com/s42144/Shark-Bounty/blob/dedf1f3379f4a52180a500e818e467dcd99f56c9/1057118.png?raw=true">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    :root {
      --primary: #27cdfc;
      --secondary: #ff61a6;
      --gradient: linear-gradient(120deg, #241132 0%, #ff459e 100%);
      --card-bg: rgba(255,255,255,0.95);
      --panel-bg: rgba(28,40,61,0.95);
      --accent: #27cdfc;
      --accent2: #ff61a6;
      --btn-gradient: linear-gradient(95deg, #27cdfc 0%, #ff61a6 100%);
      --shadow: 0 4px 32px rgba(0,0,0,0.15);
      --border-radius: 16px;
      --success: #34d399;
      --danger: #ef4444;
      --warning: #fbbf24;
      --info: #3b82f6;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: var(--gradient);
      background-attachment: fixed;
      min-height: 100vh;
      color: #333;
      overflow-x: hidden;
    }
    
    .admin-wrapper {
      min-height: 100vh;
      padding: 15px;
    }
    
    /* Header */
    .admin-header {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px 30px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .admin-logo-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .admin-logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid var(--accent2);
      object-fit: cover;
    }
    
    .admin-title {
      font-size: 1.5rem;
      font-weight: 900;
      background: var(--btn-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .admin-subtitle {
      color: #666;
      font-size: 0.9rem;
      margin-top: 4px;
    }
    
    .admin-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .online-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(52, 211, 153, 0.1);
      border-radius: 20px;
      border: 2px solid var(--success);
    }
    
    .online-dot {
      width: 10px;
      height: 10px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .logout-btn {
      background: var(--btn-gradient);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .logout-btn:hover {
      transform: translateY(-2px);
    }
    
    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-left: 5px solid var(--accent);
      transition: transform 0.2s;
      cursor: pointer;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
    }
    
    .stat-card:nth-child(2) { border-left-color: var(--accent2); }
    .stat-card:nth-child(3) { border-left-color: var(--warning); }
    .stat-card:nth-child(4) { border-left-color: var(--success); }
    .stat-card:nth-child(5) { border-left-color: var(--info); }
    
    .stat-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 900;
      color: #333;
      margin-bottom: 5px;
    }
    
    .stat-change {
      font-size: 0.8rem;
      color: var(--success);
      font-weight: 600;
    }
    
    .stat-icon {
      font-size: 2rem;
      opacity: 0.2;
      float: right;
    }
    
    /* Tabs Navigation */
    .tabs-nav {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 10px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      display: flex;
      gap: 8px;
      overflow-x: auto;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      background: transparent;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      white-space: nowrap;
      font-size: 0.9rem;
    }
    
    .tab-btn.active {
      background: var(--btn-gradient);
      color: #fff;
      box-shadow: 0 4px 12px rgba(255,97,166,0.3);
    }
    
    .tab-btn:hover:not(.active) {
      background: #f0f0f0;
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Cards */
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .card-title {
      font-size: 1.2rem;
      font-weight: 800;
      color: #333;
    }
    
    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-label {
      font-weight: 700;
      color: #333;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-input, .form-textarea, .form-select {
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
      background: #f8f9fa;
    }
    
    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
      background: #fff;
      box-shadow: 0 0 0 4px rgba(39,205,252,0.1);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .file-upload-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    
    .file-upload-btn {
      background: var(--btn-gradient);
      color: #fff;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      display: inline-block;
      width: 100%;
      text-align: center;
      transition: transform 0.2s;
    }
    
    .file-upload-btn:hover {
      transform: translateY(-2px);
    }
    
    .file-upload-input {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .image-preview {
      width: 100%;
      max-width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      margin-top: 10px;
      border: 2px solid #e0e0e0;
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
    }
    
    .btn-primary {
      background: var(--btn-gradient);
      color: #fff;
      box-shadow: 0 4px 12px rgba(255,97,166,0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255,97,166,0.4);
    }
    
    .btn-secondary {
      background: #6c757d;
      color: #fff;
    }
    
    .btn-danger {
      background: var(--danger);
      color: #fff;
    }
    
    .btn-success {
      background: var(--success);
      color: #fff;
    }
    
    .btn-info {
      background: var(--info);
      color: #fff;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 0.85rem;
    }
    
    .btn-icon {
      padding: 8px 12px;
      font-size: 1.2rem;
    }
    
    /* Tables */
    .table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      min-width: 800px;
    }
    
    .data-table thead {
      background: linear-gradient(135deg, #27cdfc 0%, #ff61a6 100%);
      color: #fff;
    }
    
    .data-table th {
      padding: 14px 12px;
      text-align: left;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }
    
    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 0.9rem;
    }
    
    .data-table tbody tr:hover {
      background: #f8f9fa;
    }
    
    .data-table img {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
    }
    
    /* Action Buttons in Table */
    .action-btns {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    /* Search Bar */
    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
    }
    
    /* User Info Card */
    .user-info-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border-radius: var(--border-radius);
      padding: 20px;
      margin-top: 15px;
    }
    
    .user-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .user-info-item {
      background: rgba(255,255,255,0.15);
      padding: 12px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }
    
    .user-info-label {
      font-size: 0.75rem;
      opacity: 0.9;
      margin-bottom: 5px;
      text-transform: uppercase;
    }
    
    .user-info-value {
      font-size: 1rem;
      font-weight: 700;
      word-break: break-word;
    }
    
    /* Wallet Section */
    .wallet-item {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      border: 2px solid #e0e0e0;
      transition: all 0.3s;
    }
    
    .wallet-item:hover {
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .wallet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .wallet-address {
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      color: #333;
      word-break: break-all;
      background: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      margin: 10px 0;
    }
    
    /* Notifications */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fff;
      border-radius: 12px;
      padding: 16px 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 12px;
      transform: translateX(400px);
      transition: transform 0.3s;
      max-width: 350px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success { border-left: 4px solid var(--success); }
    .notification.error { border-left: 4px solid var(--danger); }
    .notification.info { border-left: 4px solid var(--info); }
    .notification.warning { border-left: 4px solid var(--warning); }
    
    .notification-icon {
      font-size: 1.5rem;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .notification-message {
      font-size: 0.9rem;
      color: #666;
    }
    
    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    /* Badge */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .badge-danger {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      padding: 20px;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 30px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 1.5rem;
      font-weight: 900;
      background: var(--btn-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }
    
    /* Copy Button */
    .copy-btn {
      background: var(--info);
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .copy-btn:hover {
      transform: scale(1.05);
    }
    
    .copy-btn.copied {
      background: var(--success);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-header {
        flex-direction: column;
        text-align: center;
        padding: 15px;
      }
      
      .admin-logo-section {
        flex-direction: column;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .tabs-nav {
        flex-direction: column;
      }
      
      .tab-btn {
        width: 100%;
      }
      
      .notification {
        right: 10px;
        left: 10px;
        max-width: none;
      }
      
      .stat-value {
        font-size: 1.5rem;
      }
      
      .card {
        padding: 15px;
      }
      
      .data-table {
        font-size: 0.85rem;
      }
      
      .data-table th,
      .data-table td {
        padding: 8px;
      }
      
      .action-btns {
        flex-direction: column;
      }
      
      .btn-small {
        width: 100%;
      }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent2);
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <!-- Admin Dashboard -->
  <div class="admin-wrapper" id="adminDashboard">
    <!-- Header -->
    <div class="admin-header fade-in">
      <div class="admin-logo-section">
        <img src="https://github.com/s42144/Shark-Bounty/blob/dedf1f3379f4a52180a500e818e467dcd99f56c9/1057118.png?raw=true" alt="Logo" class="admin-logo">
        <div>
          <h1 class="admin-title">Shark Bounty</h1>
          <p class="admin-subtitle">Professional Admin Control Panel</p>
        </div>
      </div>
      <div class="admin-actions">
        <div class="online-indicator">
          <div class="online-dot"></div>
          <span id="onlineUsers">0 Online</span>
        </div>
        <button class="logout-btn" onclick="logout()">üö™ Logout</button>
      </div>
    </div>

    <!-- Dashboard Stats -->
    <div class="dashboard-grid fade-in">
      <div class="stat-card" onclick="switchTab('users')">
        <div class="stat-icon">üë•</div>
        <div class="stat-label">Total Users</div>
        <div class="stat-value" id="totalUsers">0</div>
        <div class="stat-change" id="usersChange">+0 today</div>
      </div>
      <div class="stat-card" onclick="switchTab('users')">
        <div class="stat-icon">üí∞</div>
        <div class="stat-label">Total Balance</div>
        <div class="stat-value" id="totalBalance">0 SHB</div>
        <div class="stat-change" id="balanceChange">Circulating</div>
      </div>
      <div class="stat-card" onclick="switchTab('tasks')">
        <div class="stat-icon">üìã</div>
        <div class="stat-label">Active Tasks</div>
        <div class="stat-value" id="totalTasks">0</div>
        <div class="stat-change" id="tasksChange">Available</div>
      </div>
      <div class="stat-card" onclick="switchTab('wallets')">
        <div class="stat-icon">üè¶</div>
        <div class="stat-label">Wallet Addresses</div>
        <div class="stat-value" id="totalWallets">0</div>
        <div class="stat-change">Connected</div>
      </div>
      <div class="stat-card" onclick="switchTab('analytics')">
        <div class="stat-icon">üìä</div>
        <div class="stat-label">Total Referrals</div>
        <div class="stat-value" id="totalReferrals">0</div>
        <div class="stat-change">Network</div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-nav fade-in">
      <button class="tab-btn active" data-tab="overview">üìä Overview</button>
      <button class="tab-btn" data-tab="users">üë• Users</button>
      <button class="tab-btn" data-tab="tasks">üìã Tasks</button>
      <button class="tab-btn" data-tab="wallets">üè¶ Wallets</button>
      <button class="tab-btn" data-tab="profile-sections">üéØ Sections</button>
      <button class="tab-btn" data-tab="home-ui">üé® Home UI</button>
      <button class="tab-btn" data-tab="redeem">üéÅ Redeem</button>
      <button class="tab-btn" data-tab="analytics">üìà Analytics</button>
      <button class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</button>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content active" id="overview">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üìä System Overview</h2>
          <button class="btn btn-info btn-small" onclick="refreshStats()">üîÑ Refresh</button>
        </div>
        <div style="height: 300px;">
          <canvas id="overviewChart"></canvas>
        </div>
      </div>
      
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üî• Recent Activity</h2>
        </div>
        <div id="recentActivity">
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <div class="empty-state-text">Loading activity data...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div class="tab-content" id="users">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üîç Search User</h2>
        </div>
        <div class="search-bar">
          <input type="text" class="search-input" id="searchUserId" placeholder="Enter User ID or Telegram Username...">
          <button class="btn btn-primary" onclick="searchUser()">üîç Search</button>
        </div>
        <div id="userInfoContainer"></div>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üë• All Users</h2>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <span class="badge badge-info" id="userCount">0 Users</span>
            <button class="btn btn-success btn-small" onclick="exportUsers()">üì• Export CSV</button>
            <button class="btn btn-info btn-small" onclick="loadUsers()">üîÑ Refresh</button>
          </div>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Telegram</th>
                <th>Balance</th>
                <th>Country</th>
                <th>Device</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <tr>
                <td colspan="6" style="text-align: center; padding: 40px;">
                  <div class="loading-spinner" style="margin: 0 auto;"></div>
                  <p style="margin-top: 10px; color: #999;">Loading users...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Tasks Tab -->
    <div class="tab-content" id="tasks">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">‚ûï Add New Task</h2>
        </div>
        <form id="taskForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Task Name</label>
              <input type="text" class="form-input" id="taskName" placeholder="Enter task name" required>
            </div>
            <div class="form-group">
              <label class="form-label">Reward (SHB)</label>
              <input type="number" class="form-input" id="taskAmount" placeholder="1000" min="1" required>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Task Link</label>
              <input type="url" class="form-input" id="taskLink" placeholder="https://..." required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Task Photo</label>
            <div class="file-upload-wrapper">
              <label class="file-upload-btn">
                üì∑ Upload from Gallery
                <input type="file" class="file-upload-input" id="taskPhotoFile" accept="image/*" onchange="handleTaskImageUpload(event)">
              </label>
            </div>
            <input type="url" class="form-input" id="taskPhoto" placeholder="Or paste image URL..." style="margin-top: 10px;">
            <img id="taskPhotoPreview" class="image-preview" style="display: none;">
          </div>
          <button type="submit" class="btn btn-primary">
            <span id="taskBtnText">‚ûï Add Task</span>
          </button>
        </form>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üìã All Tasks</h2>
          <span class="badge badge-info" id="taskCount">0 Tasks</span>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Photo</th>
                <th>Name</th>
                <th>Reward</th>
                <th>Link</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tasksTableBody">
              <tr>
                <td colspan="5" style="text-align: center; padding: 40px;">
                  <div class="loading-spinner" style="margin: 0 auto;"></div>
                  <p style="margin-top: 10px; color: #999;">Loading tasks...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Wallets Tab -->
    <div class="tab-content" id="wallets">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üè¶ Wallet Addresses</h2>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn btn-success btn-small" onclick="copyAllWallets()">üìã Copy All</button>
            <button class="btn btn-info btn-small" onclick="exportWallets()">üì• Export TXT</button>
            <button class="btn btn-primary btn-small" onclick="loadWallets()">üîÑ Refresh</button>
          </div>
        </div>
        <div id="walletsContainer">
          <div class="empty-state">
            <div class="empty-state-icon">üè¶</div>
            <div class="empty-state-text">Loading wallet addresses...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Sections Tab -->
    <div class="tab-content" id="profile-sections">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">‚ûï Add Profile Section</h2>
        </div>
        <form id="profileSectionForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Section Name</label>
              <input type="text" class="form-input" id="sectionName" placeholder="e.g., RoadMap" required>
            </div>
            <div class="form-group">
              <label class="form-label">Link URL</label>
              <input type="url" class="form-input" id="sectionLink" placeholder="https://..." required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Section Image</label>
            <div class="file-upload-wrapper">
              <label class="file-upload-btn">
                üì∑ Upload from Gallery
                <input type="file" class="file-upload-input" id="sectionImageFile" accept="image/*" onchange="handleSectionImageUpload(event)">
              </label>
            </div>
            <input type="url" class="form-input" id="sectionImage" placeholder="Or paste image URL..." style="margin-top: 10px;">
            <img id="sectionImagePreview" class="image-preview" style="display: none;">
          </div>
          <button type="submit" class="btn btn-primary">
            <span id="sectionBtnText">‚ûï Add Section</span>
          </button>
        </form>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üéØ Profile Sections</h2>
          <span class="badge badge-info" id="sectionCount">0 Sections</span>
        </div>
        <div class="profile-section-preview" id="profileSectionsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
          <div class="empty-state">
            <div class="empty-state-icon">üéØ</div>
            <div class="empty-state-text">No sections yet. Add your first section!</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Home UI Tab -->
    <div class="tab-content" id="home-ui">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üé® Home UI Customization</h2>
        </div>
        <form id="homeUIForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Logo Image</label>
              <div class="file-upload-wrapper">
                <label class="file-upload-btn">
                  üì∑ Upload Logo
                  <input type="file" class="file-upload-input" id="logoFile" accept="image/*" onchange="handleLogoUpload(event)">
                </label>
              </div>
              <input type="url" class="form-input" id="logoUrl" placeholder="Or paste logo URL..." style="margin-top: 10px;">
              <img id="logoPreview" class="image-preview" style="display: none;">
            </div>
            <div class="form-group">
              <label class="form-label">Background Image</label>
              <div class="file-upload-wrapper">
                <label class="file-upload-btn">
                  üì∑ Upload Background
                  <input type="file" class="file-upload-input" id="bgFile" accept="image/*" onchange="handleBgUpload(event)">
                </label>
              </div>
              <input type="url" class="form-input" id="bgUrl" placeholder="Or paste background URL..." style="margin-top: 10px;">
              <img id="bgPreview" class="image-preview" style="display: none;">
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Primary Color</label>
              <input type="color" class="form-input" id="primaryColor" value="#27cdfc">
            </div>
            <div class="form-group">
              <label class="form-label">Secondary Color</label>
              <input type="color" class="form-input" id="secondaryColor" value="#ff61a6">
            </div>
          </div>
          <button type="submit" class="btn btn-primary">üíæ Save UI Settings</button>
        </form>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üëÅÔ∏è Current UI Preview</h2>
        </div>
        <div id="uiPreview" style="padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
          <p style="color: #666;">UI preview will appear here after saving settings</p>
        </div>
      </div>
    </div>

    <!-- Redeem Codes Tab -->
    <div class="tab-content" id="redeem">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">‚ûï Generate Redeem Code</h2>
        </div>
        <form id="redeemForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">4-Digit Code</label>
              <input type="text" class="form-input" id="redeemCode" placeholder="1234" maxlength="4" pattern="[0-9]{4}" required>
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
              <button type="submit" class="btn btn-primary" style="width: 100%;">üéÅ Generate Code</button>
            </div>
          </div>
        </form>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üéÅ Active Redeem Codes</h2>
          <span class="badge badge-success" id="redeemCount">0 Codes</span>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Code</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="redeemTableBody">
              <tr>
                <td colspan="3" style="text-align: center; padding: 40px;">
                  <div class="empty-state">
                    <div class="empty-state-icon">üéÅ</div>
                    <div class="empty-state-text">No redeem codes yet</div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" id="analytics">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üìà User Growth</h2>
        </div>
        <div style="height: 300px;">
          <canvas id="userGrowthChart"></canvas>
        </div>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üí∞ Balance Distribution</h2>
        </div>
        <div style="height: 300px;">
          <canvas id="balanceChart"></canvas>
        </div>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üåç Users by Country</h2>
        </div>
        <div id="countryStats">
          <div class="empty-state">
            <div class="empty-state-icon">üåç</div>
            <div class="empty-state-text">Loading country statistics...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content" id="settings">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">‚öôÔ∏è Bot Settings</h2>
        </div>
        <form id="settingsForm">
          <div class="form-group">
            <label class="form-label">Telegram Bot Token</label>
            <input type="text" class="form-input" id="botToken" value="8237387201:AAFI98932KS3M5uJDLaTbu27FCFOJ40wwxI" readonly>
            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">Bot API is integrated and active</p>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Default Energy</label>
              <input type="number" class="form-input" id="defaultEnergy" value="1200">
            </div>
            <div class="form-group">
              <label class="form-label">Default Multi Tap</label>
              <input type="number" class="form-input" id="defaultMultiTap" value="1">
            </div>
          </div>
          <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
        </form>
      </div>

      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title">üóÑÔ∏è Database Management</h2>
        </div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button class="btn btn-info" onclick="backupDatabase()">üíæ Backup Database</button>
          <button class="btn btn-warning" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
          <button class="btn btn-danger" onclick="confirmReset()">‚ö†Ô∏è Reset Database</button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Detail Modal -->
  <div class="modal" id="userModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">üë§ User Details</h2>
        <button class="modal-close" onclick="closeModal('userModal')">‚úï</button>
      </div>
      <div id="userModalContent"></div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notificationContainer"></div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAHofuS76xf2oGPaJqEtopmcxdoJzjkDL4",
      authDomain: "zmex-investments.firebaseapp.com",
      databaseURL: "https://zmex-investments-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "zmex-investments",
      storageBucket: "zmex-investments.appspot.com",
      messagingSenderId: "971623941364",
      appId: "1:971623941364:web:6c65604fc45c3f64e74aa1",
      measurementId: "G-KQ1LYP77JF"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    // Telegram Bot Configuration
    const BOT_TOKEN = '8237387201:AAFI98932KS3M5uJDLaTbu27FCFOJ40wwxI';
    const BOT_API = `https://api.telegram.org/bot${BOT_TOKEN}`;

    // Global Variables
    let editingTaskId = null;
    let editingSectionId = null;
    let allUsers = {};
    let allWallets = {};

    // Notification System
    function showNotification(title, message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        info: '‚ÑπÔ∏è',
        warning: '‚ö†Ô∏è'
      };
      
      notification.innerHTML = `
        <div class="notification-icon">${icons[type]}</div>
        <div class="notification-content">
          <div class="notification-title">${title}</div>
          <div class="notification-message">${message}</div>
        </div>
      `;
      
      container.appendChild(notification);
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // Initialize Dashboard
    async function initializeDashboard() {
      await loadStats();
      await loadTasks();
      await loadUsers();
      await loadWallets();
      await loadProfileSections();
      await loadRedeemCodes();
      initializeCharts();
      
      // Refresh stats every 10 seconds
      setInterval(loadStats, 10000);
    }

    // Load Statistics
    async function loadStats() {
      try {
        const usersSnap = await db.ref('users').once('value');
        const tasksSnap = await db.ref('tasks').once('value');
        
        let totalUsers = 0;
        let totalBalance = 0;
        let totalReferrals = 0;
        let onlineUsers = 0;
        
        usersSnap.forEach(userSnap => {
          totalUsers++;
          const user = userSnap.val();
          totalBalance += (user.balance || 0);
          totalReferrals += (user.referrals || 0);
          
          // Check if user was active in last 5 minutes
          if (user.lastActive && (Date.now() - user.lastActive) < 300000) {
            onlineUsers++;
          }
        });
        
        const totalTasks = tasksSnap.numChildren();
        
        // Count wallets
        let walletCount = 0;
        usersSnap.forEach(userSnap => {
          const user = userSnap.val();
          if (user.ton && user.ton !== 'Not set') {
            walletCount++;
          }
        });
        
        document.getElementById('totalUsers').textContent = totalUsers.toLocaleString();
        document.getElementById('totalBalance').textContent = totalBalance.toLocaleString() + ' SHB';
        document.getElementById('totalTasks').textContent = totalTasks;
        document.getElementById('totalWallets').textContent = walletCount;
        document.getElementById('totalReferrals').textContent = totalReferrals.toLocaleString();
        document.getElementById('onlineUsers').textContent = `${onlineUsers} Online`;
        
        document.getElementById('taskCount').textContent = `${totalTasks} Tasks`;
        document.getElementById('userCount').textContent = `${totalUsers} Users`;
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Refresh Stats
    function refreshStats() {
      showNotification('Refreshing', 'Updating statistics...', 'info');
      loadStats();
    }

    // Tab Navigation
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        switchTab(btn.dataset.tab);
      });
    });

    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      const btn = document.querySelector(`[data-tab="${tabName}"]`);
      if (btn) {
        btn.classList.add('active');
        document.getElementById(tabName).classList.add('active');
      }
    }

    // Image Upload Handlers
    async function handleTaskImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        showNotification('Uploading', 'Uploading image...', 'info');
        const storageRef = storage.ref(`tasks/${Date.now()}_${file.name}`);
        const snapshot = await storageRef.put(file);
        const url = await snapshot.ref.getDownloadURL();
        
        document.getElementById('taskPhoto').value = url;
        document.getElementById('taskPhotoPreview').src = url;
        document.getElementById('taskPhotoPreview').style.display = 'block';
        
        showNotification('Success', 'Image uploaded successfully!', 'success');
      } catch (error) {
        showNotification('Error', 'Failed to upload image', 'error');
        console.error(error);
      }
    }

    async function handleSectionImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        showNotification('Uploading', 'Uploading image...', 'info');
        const storageRef = storage.ref(`sections/${Date.now()}_${file.name}`);
        const snapshot = await storageRef.put(file);
        const url = await snapshot.ref.getDownloadURL();
        
        document.getElementById('sectionImage').value = url;
        document.getElementById('sectionImagePreview').src = url;
        document.getElementById('sectionImagePreview').style.display = 'block';
        
        showNotification('Success', 'Image uploaded successfully!', 'success');
      } catch (error) {
        showNotification('Error', 'Failed to upload image', 'error');
        console.error(error);
      }
    }

    async function handleLogoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        showNotification('Uploading', 'Uploading logo...', 'info');
        const storageRef = storage.ref(`ui/logo_${Date.now()}_${file.name}`);
        const snapshot = await storageRef.put(file);
        const url = await snapshot.ref.getDownloadURL();
        
        document.getElementById('logoUrl').value = url;
        document.getElementById('logoPreview').src = url;
        document.getElementById('logoPreview').style.display = 'block';
        
        showNotification('Success', 'Logo uploaded successfully!', 'success');
      } catch (error) {
        showNotification('Error', 'Failed to upload logo', 'error');
        console.error(error);
      }
    }

    async function handleBgUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        showNotification('Uploading', 'Uploading background...', 'info');
        const storageRef = storage.ref(`ui/bg_${Date.now()}_${file.name}`);
        const snapshot = await storageRef.put(file);
        const url = await snapshot.ref.getDownloadURL();
        
        document.getElementById('bgUrl').value = url;
        document.getElementById('bgPreview').src = url;
        document.getElementById('bgPreview').style.display = 'block';
        
        showNotification('Success', 'Background uploaded successfully!', 'success');
      } catch (error) {
        showNotification('Error', 'Failed to upload background', 'error');
        console.error(error);
      }
    }

    // Task Management
    document.getElementById('taskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('taskName').value.trim();
      const photo = document.getElementById('taskPhoto').value.trim();
      const link = document.getElementById('taskLink').value.trim();
      const amount = parseInt(document.getElementById('taskAmount').value);
      
      if (!photo) {
        showNotification('Error', 'Please upload an image or provide URL', 'error');
        return;
      }
      
      const btnText = document.getElementById('taskBtnText');
      btnText.innerHTML = '<div class="loading-spinner"></div>';
      
      try {
        if (editingTaskId) {
          await db.ref('tasks/' + editingTaskId).update({ name, photo, link, amount });
          showNotification('Success', 'Task updated successfully!', 'success');
          editingTaskId = null;
          btnText.textContent = '‚ûï Add Task';
        } else {
          const taskId = Date.now().toString();
          await db.ref('tasks/' + taskId).set({ name, photo, link, amount });
          showNotification('Success', 'Task added successfully!', 'success');
        }
        
        document.getElementById('taskForm').reset();
        document.getElementById('taskPhotoPreview').style.display = 'none';
        loadTasks();
      } catch (error) {
        showNotification('Error', error.message, 'error');
        btnText.textContent = editingTaskId ? 'üíæ Update Task' : '‚ûï Add Task';
      }
    });

    async function loadTasks() {
      try {
        const snapshot = await db.ref('tasks').once('value');
        const tasks = snapshot.val() || {};
        const tbody = document.getElementById('tasksTableBody');
        
        const count = Object.keys(tasks).length;
        document.getElementById('taskCount').textContent = `${count} Tasks`;
        
        if (count === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" style="text-align: center; padding: 40px;">
                <div class="empty-state">
                  <div class="empty-state-icon">üìã</div>
                  <div class="empty-state-text">No tasks yet. Add your first task!</div>
                </div>
              </td>
            </tr>
          `;
          return;
        }
        
        tbody.innerHTML = '';
        
        Object.entries(tasks).forEach(([taskId, task]) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><img src="${task.photo}" alt="${task.name}"></td>
            <td><strong>${task.name}</strong></td>
            <td><span class="badge badge-success">${task.amount} SHB</span></td>
            <td><a href="${task.link}" target="_blank" style="color: var(--accent);">üîó View</a></td>
            <td>
              <div class="action-btns">
                <button class="btn btn-small btn-primary" onclick="editTask('${taskId}')">‚úèÔ∏è Edit</button>
                <button class="btn btn-small btn-danger" onclick="deleteTask('${taskId}')">üóëÔ∏è Delete</button>
              </div>
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading tasks:', error);
      }
    }

    window.editTask = async (taskId) => {
      try {
        const snapshot = await db.ref('tasks/' + taskId).once('value');
        const task = snapshot.val();
        
        document.getElementById('taskName').value = task.name;
        document.getElementById('taskPhoto').value = task.photo;
        document.getElementById('taskLink').value = task.link;
        document.getElementById('taskAmount').value = task.amount;
        document.getElementById('taskPhotoPreview').src = task.photo;
        document.getElementById('taskPhotoPreview').style.display = 'block';
        
        editingTaskId = taskId;
        document.getElementById('taskBtnText').textContent = 'üíæ Update Task';
        
        switchTab('tasks');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    };

    window.deleteTask = async (taskId) => {
      if (!confirm('Are you sure you want to delete this task?')) return;
      
      try {
        await db.ref('tasks/' + taskId).remove();
        showNotification('Success', 'Task deleted successfully!', 'success');
        loadTasks();
        loadStats();
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    };

    // User Management
    async function loadUsers() {
      try {
        const snapshot = await db.ref('users').once('value');
        allUsers = snapshot.val() || {};
        const tbody = document.getElementById('usersTableBody');
        
        const count = Object.keys(allUsers).length;
        document.getElementById('userCount').textContent = `${count} Users`;
        
        if (count === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px;">
                <div class="empty-state">
                  <div class="empty-state-icon">üë•</div>
                  <div class="empty-state-text">No users yet</div>
                </div>
              </td>
            </tr>
          `;
          return;
        }
        
        tbody.innerHTML = '';
        
        // Show first 50 users
        const userEntries = Object.entries(allUsers).slice(0, 50);
        
        for (const [userId, user] of userEntries) {
          const row = document.createElement('tr');
          
          // Get Telegram info
          let telegramInfo = userId;
          if (user.telegramUsername) {
            telegramInfo = `@${user.telegramUsername}`;
          } else if (user.firstName) {
            telegramInfo = user.firstName;
          }
          
          row.innerHTML = `
            <td><strong>${userId}</strong></td>
            <td>${telegramInfo}</td>
            <td><span class="badge badge-success">${(user.balance || 0).toLocaleString()} SHB</span></td>
            <td>${user.country || 'üåç Unknown'}</td>
            <td>${user.device || 'üì± Unknown'}</td>
            <td>
              <div class="action-btns">
                <button class="btn btn-small btn-primary" onclick="viewUserDetails('${userId}')">üëÅÔ∏è View</button>
                <button class="btn btn-small btn-success" onclick="adjustBalance('${userId}')">üí∞ Balance</button>
              </div>
            </td>
          `;
          tbody.appendChild(row);
        }
        
        if (count > 50) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
              Showing 50 of ${count} users. Use search to find specific users.
            </td>
          `;
          tbody.appendChild(row);
        }
      } catch (error) {
        console.error('Error loading users:', error);
      }
    }

    async function searchUser() {
      const searchTerm = document.getElementById('searchUserId').value.trim().toLowerCase();
      
      if (!searchTerm) {
        showNotification('Error', 'Please enter a user ID or username', 'error');
        return;
      }
      
      try {
        // Search by ID first
        let snapshot = await db.ref('users/' + searchTerm).once('value');
        
        if (!snapshot.exists()) {
          // Search by username
          const allUsersSnap = await db.ref('users').once('value');
          let found = false;
          
          allUsersSnap.forEach(userSnap => {
            const user = userSnap.val();
            if (user.telegramUsername && user.telegramUsername.toLowerCase() === searchTerm.replace('@', '')) {
              snapshot = userSnap;
              found = true;
            }
          });
          
          if (!found) {
            showNotification('Error', 'User not found', 'error');
            document.getElementById('userInfoContainer').innerHTML = '';
            return;
          }
        }
        
        const userId = snapshot.key;
        const user = snapshot.val();
        
        // Fetch Telegram data
        let telegramData = null;
        try {
          const response = await fetch(`${BOT_API}/getChat?chat_id=${userId}`);
          const data = await response.json();
          if (data.ok) {
            telegramData = data.result;
          }
        } catch (e) {
          console.log('Could not fetch Telegram data');
        }
        
        document.getElementById('userInfoContainer').innerHTML = `
          <div class="user-info-card">
            <h3 style="margin-bottom: 15px;">üë§ User Details</h3>
            <div class="user-info-grid">
              <div class="user-info-item">
                <div class="user-info-label">User ID</div>
                <div class="user-info-value">${userId}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Telegram Username</div>
                <div class="user-info-value">${telegramData?.username ? '@' + telegramData.username : (user.telegramUsername ? '@' + user.telegramUsername : 'Not set')}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">First Name</div>
                <div class="user-info-value">${telegramData?.first_name || user.firstName || 'Not set'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Last Name</div>
                <div class="user-info-value">${telegramData?.last_name || user.lastName || 'Not set'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Balance</div>
                <div class="user-info-value">${(user.balance || 0).toLocaleString()} SHB</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Energy</div>
                <div class="user-info-value">${user.energy || 0} / ${user.maxEnergy || 1200}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Multi Tap</div>
                <div class="user-info-value">${user.multiTap || 1}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Referrals</div>
                <div class="user-info-value">${user.referrals || 0}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Country</div>
                <div class="user-info-value">${user.country || 'üåç Unknown'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Mobile</div>
                <div class="user-info-value">${user.mobile || 'Not set'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">IP Address</div>
                <div class="user-info-value">${user.ipAddress || 'Unknown'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Device</div>
                <div class="user-info-value">${user.device || 'üì± Unknown'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">TON Wallet</div>
                <div class="user-info-value" style="font-size: 0.75rem;">${user.ton || 'Not set'}</div>
              </div>
              <div class="user-info-item">
                <div class="user-info-label">Last Active</div>
                <div class="user-info-value">${user.lastActive ? new Date(user.lastActive).toLocaleString() : 'Never'}</div>
              </div>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="adjustBalance('${userId}')">üí∞ Adjust Balance</button>
              <button class="btn btn-info" onclick="viewUserDetails('${userId}')">üëÅÔ∏è Full Details</button>
            </div>
          </div>
        `;
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    }

    function viewUserDetails(userId) {
      // Implementation for detailed user view
      showNotification('Info', 'Opening user details...', 'info');
      searchUser();
    }

    function adjustBalance(userId) {
      const amount = prompt('Enter amount to add (use negative for deduction):');
      if (amount === null) return;
      
      const numAmount = parseInt(amount);
      if (isNaN(numAmount)) {
        showNotification('Error', 'Invalid amount', 'error');
        return;
      }
      
      db.ref('users/' + userId + '/balance').transaction(currentBalance => {
        return (currentBalance || 0) + numAmount;
      }).then(() => {
        showNotification('Success', `Balance adjusted by ${numAmount} SHB`, 'success');
        loadUsers();
        loadStats();
      }).catch(error => {
        showNotification('Error', error.message, 'error');
      });
    }

    function exportUsers() {
      const csv = ['User ID,Telegram,Balance,Country,Device,Mobile,IP,Wallet'];
      
      Object.entries(allUsers).forEach(([userId, user]) => {
        const telegram = user.telegramUsername ? '@' + user.telegramUsername : (user.firstName || 'N/A');
        const row = [
          userId,
          telegram,
          user.balance || 0,
          user.country || 'Unknown',
          user.device || 'Unknown',
          user.mobile || 'N/A',
          user.ipAddress || 'Unknown',
          user.ton || 'Not set'
        ];
        csv.push(row.join(','));
      });
      
      const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `users_${Date.now()}.csv`;
      a.click();
      
      showNotification('Success', 'Users exported successfully!', 'success');
    }

    // Wallet Management
    async function loadWallets() {
      try {
        const snapshot = await db.ref('users').once('value');
        allWallets = {};
        const container = document.getElementById('walletsContainer');
        
        snapshot.forEach(userSnap => {
          const userId = userSnap.key;
          const user = userSnap.val();
          
          if (user.ton && user.ton !== 'Not set') {
            allWallets[userId] = {
              wallet: user.ton,
              balance: user.balance || 0,
              username: user.telegramUsername || user.firstName || userId
            };
          }
        });
        
        const count = Object.keys(allWallets).length;
        
        if (count === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üè¶</div>
              <div class="empty-state-text">No wallet addresses yet</div>
            </div>
          `;
          return;
        }
        
        container.innerHTML = '';
        
        Object.entries(allWallets).forEach(([userId, data]) => {
          const item = document.createElement('div');
          item.className = 'wallet-item';
          item.innerHTML = `
            <div class="wallet-header">
              <div>
                <strong>@${data.username}</strong>
                <span class="badge badge-info" style="margin-left: 10px;">${data.balance.toLocaleString()} SHB</span>
              </div>
              <button class="copy-btn" onclick="copyWallet('${data.wallet}', this)">üìã Copy</button>
            </div>
            <div class="wallet-address">${data.wallet}</div>
            <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
              User ID: ${userId}
            </div>
          `;
          container.appendChild(item);
        });
      } catch (error) {
        console.error('Error loading wallets:', error);
      }
    }

    function copyWallet(wallet, btn) {
      navigator.clipboard.writeText(wallet).then(() => {
        btn.textContent = '‚úÖ Copied';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'üìã Copy';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    function copyAllWallets() {
      const text = Object.entries(allWallets).map(([userId, data]) => {
        return `@${data.username} (${userId}): ${data.wallet} - ${data.balance} SHB`;
      }).join('\n');
      
      navigator.clipboard.writeText(text).then(() => {
        showNotification('Success', 'All wallets copied to clipboard!', 'success');
      });
    }

    function exportWallets() {
      const text = Object.entries(allWallets).map(([userId, data]) => {
        return `Username: @${data.username}\nUser ID: ${userId}\nWallet: ${data.wallet}\nBalance: ${data.balance} SHB\n${'='.repeat(50)}`;
      }).join('\n\n');
      
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `wallets_${Date.now()}.txt`;
      a.click();
      
      showNotification('Success', 'Wallets exported to TXT file!', 'success');
    }

    // Profile Sections Management
    document.getElementById('profileSectionForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('sectionName').value.trim();
      const image = document.getElementById('sectionImage').value.trim();
      const link = document.getElementById('sectionLink').value.trim();
      
      if (!image) {
        showNotification('Error', 'Please upload an image or provide URL', 'error');
        return;
      }
      
      const btnText = document.getElementById('sectionBtnText');
      btnText.innerHTML = '<div class="loading-spinner"></div>';
      
      try {
        if (editingSectionId) {
          await db.ref('profileSections/' + editingSectionId).update({ name, image, link });
          showNotification('Success', 'Section updated successfully!', 'success');
          editingSectionId = null;
          btnText.textContent = '‚ûï Add Section';
        } else {
          const sectionId = name.toLowerCase().replace(/\s+/g, '_');
          await db.ref('profileSections/' + sectionId).set({ name, image, link });
          showNotification('Success', 'Section added successfully!', 'success');
        }
        
        document.getElementById('profileSectionForm').reset();
        document.getElementById('sectionImagePreview').style.display = 'none';
        loadProfileSections();
      } catch (error) {
        showNotification('Error', error.message, 'error');
        btnText.textContent = editingSectionId ? 'üíæ Update Section' : '‚ûï Add Section';
      }
    });

    async function loadProfileSections() {
      try {
        const snapshot = await db.ref('profileSections').once('value');
        const sections = snapshot.val() || {};
        const container = document.getElementById('profileSectionsContainer');
        
        const count = Object.keys(sections).length;
        document.getElementById('sectionCount').textContent = `${count} Sections`;
        
        if (count === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üéØ</div>
              <div class="empty-state-text">No sections yet. Add your first section!</div>
            </div>
          `;
          return;
        }
        
        container.innerHTML = '';
        
        Object.entries(sections).forEach(([sectionId, section]) => {
          const item = document.createElement('div');
          item.style.cssText = 'background: #f8f9fa; border-radius: 12px; padding: 15px; text-align: center; border: 2px solid #e0e0e0; transition: all 0.3s;';
          item.innerHTML = `
            <img src="${section.image}" alt="${section.name}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
            <div style="font-weight: 700; color: #333; margin-bottom: 8px;">${section.name}</div>
            <div style="font-size: 0.85rem; color: #666; word-break: break-all; margin-bottom: 10px;">${section.link}</div>
            <div class="action-btns" style="margin-top: 10px;">
              <button class="btn btn-small btn-primary" onclick="editSection('${sectionId}')">‚úèÔ∏è Edit</button>
              <button class="btn btn-small btn-danger" onclick="deleteSection('${sectionId}')">üóëÔ∏è Delete</button>
            </div>
          `;
          container.appendChild(item);
        });
      } catch (error) {
        console.error('Error loading profile sections:', error);
      }
    }

    window.editSection = async (sectionId) => {
      try {
        const snapshot = await db.ref('profileSections/' + sectionId).once('value');
        const section = snapshot.val();
        
        document.getElementById('sectionName').value = section.name;
        document.getElementById('sectionImage').value = section.image;
        document.getElementById('sectionLink').value = section.link;
        document.getElementById('sectionImagePreview').src = section.image;
        document.getElementById('sectionImagePreview').style.display = 'block';
        
        editingSectionId = sectionId;
        document.getElementById('sectionBtnText').textContent = 'üíæ Update Section';
        
        switchTab('profile-sections');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    };

    window.deleteSection = async (sectionId) => {
      if (!confirm('Are you sure you want to delete this section?')) return;
      
      try {
        await db.ref('profileSections/' + sectionId).remove();
        showNotification('Success', 'Section deleted successfully!', 'success');
        loadProfileSections();
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    };

    // Home UI Management
    document.getElementById('homeUIForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const logoUrl = document.getElementById('logoUrl').value.trim();
      const bgUrl = document.getElementById('bgUrl').value.trim();
      const primaryColor = document.getElementById('primaryColor').value;
      const secondaryColor = document.getElementById('secondaryColor').value;
      
      try {
        await db.ref('uiSettings').set({
          logo: logoUrl,
          background: bgUrl,
          primaryColor,
          secondaryColor,
          updatedAt: Date.now()
        });
        
        showNotification('Success', 'UI settings saved successfully!', 'success');
        
        // Update preview
        document.getElementById('uiPreview').innerHTML = `
          <div style="background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%); padding: 30px; border-radius: 15px; color: white;">
            ${logoUrl ? `<img src="${logoUrl}" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 15px;">` : ''}
            <h3>UI Preview</h3>
            <p>Primary Color: ${primaryColor}</p>
            <p>Secondary Color: ${secondaryColor}</p>
          </div>
        `;
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    });

    // Redeem Codes Management
    document.getElementById('redeemForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const code = document.getElementById('redeemCode').value.trim();
      
      if (code.length !== 4 || !/^\d+$/.test(code)) {
        showNotification('Error', 'Code must be 4 digits', 'error');
        return;
      }
      
      try {
        await db.ref('redeemCodes/' + code).set(true);
        showNotification('Success', 'Redeem code generated!', 'success');
        document.getElementById('redeemForm').reset();
        loadRedeemCodes();
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    });

    async function loadRedeemCodes() {
      try {
        const snapshot = await db.ref('redeemCodes').once('value');
        const codes = snapshot.val() || {};
        const tbody = document.getElementById('redeemTableBody');
        
        const count = Object.keys(codes).length;
        document.getElementById('redeemCount').textContent = `${count} Codes`;
        
        if (count === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="3" style="text-align: center; padding: 40px;">
                <div class="empty-state">
                  <div class="empty-state-icon">üéÅ</div>
                  <div class="empty-state-text">No redeem codes yet</div>
                </div>
              </td>
            </tr>
          `;
          return;
        }
        
        tbody.innerHTML = '';
        
        Object.keys(codes).forEach(code => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><strong style="font-size: 1.2rem; letter-spacing: 2px;">${code}</strong></td>
            <td><span class="badge badge-success">Active</span></td>
            <td>
              <button class="btn btn-small btn-danger" onclick="deleteRedeemCode('${code}')">üóëÔ∏è Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading redeem codes:', error);
      }
    }

    window.deleteRedeemCode = async (code) => {
      if (!confirm('Are you sure you want to delete this code?')) return;
      
      try {
        await db.ref('redeemCodes/' + code).remove();
        showNotification('Success', 'Code deleted successfully!', 'success');
        loadRedeemCodes();
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    };

    // Settings Management
    document.getElementById('settingsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const defaultEnergy = parseInt(document.getElementById('defaultEnergy').value);
      const defaultMultiTap = parseInt(document.getElementById('defaultMultiTap').value);
      
      try {
        await db.ref('settings').set({
          defaultEnergy,
          defaultMultiTap,
          botToken: BOT_TOKEN,
          updatedAt: Date.now()
        });
        
        showNotification('Success', 'Settings saved successfully!', 'success');
      } catch (error) {
        showNotification('Error', error.message, 'error');
      }
    });

    function backupDatabase() {
      showNotification('Info', 'Creating backup...', 'info');
      
      db.ref().once('value').then(snapshot => {
        const data = snapshot.val();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `backup_${Date.now()}.json`;
        a.click();
        
        showNotification('Success', 'Backup created successfully!', 'success');
      });
    }

    function clearCache() {
      if (!confirm('Are you sure you want to clear cache?')) return;
      
      localStorage.clear();
      sessionStorage.clear();
      showNotification('Success', 'Cache cleared successfully!', 'success');
    }

    function confirmReset() {
      const confirmation = prompt('Type "RESET" to confirm database reset:');
      if (confirmation === 'RESET') {
        showNotification('Warning', 'This feature is disabled for safety', 'warning');
      }
    }

    // Charts
    function initializeCharts() {
      // Overview Chart
      const overviewCtx = document.getElementById('overviewChart').getContext('2d');
      new Chart(overviewCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Users',
            data: [12, 19, 15, 25, 22, 30, 35],
            borderColor: '#27cdfc',
            backgroundColor: 'rgba(39, 205, 252, 0.1)',
            tension: 0.4
          }, {
            label: 'Tasks Completed',
            data: [8, 15, 12, 20, 18, 25, 28],
            borderColor: '#ff61a6',
            backgroundColor: 'rgba(255, 97, 166, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          }
        }
      });

      // User Growth Chart
      const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
      new Chart(userGrowthCtx, {
        type: 'bar',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [{
            label: 'New Users',
            data: [45, 67, 89, 112],
            backgroundColor: 'rgba(39, 205, 252, 0.8)',
            borderColor: '#27cdfc',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });

      // Balance Chart
      const balanceCtx = document.getElementById('balanceChart').getContext('2d');
      new Chart(balanceCtx, {
        type: 'doughnut',
        data: {
          labels: ['0-1000 SHB', '1000-5000 SHB', '5000-10000 SHB', '10000+ SHB'],
          datasets: [{
            data: [30, 40, 20, 10],
            backgroundColor: [
              'rgba(39, 205, 252, 0.8)',
              'rgba(255, 97, 166, 0.8)',
              'rgba(255, 210, 62, 0.8)',
              'rgba(52, 211, 153, 0.8)'
            ],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    // Modal Functions
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }

    // Logout
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        window.location.href = 'login.html';
      }
    }

    // Initialize on load
    window.addEventListener('load', () => {
      initializeDashboard();
    });
  </script>
</body>
</html>
